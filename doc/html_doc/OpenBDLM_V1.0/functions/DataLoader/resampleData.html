<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of resampleData</title>
  <meta name="keywords" content="resampleData">
  <meta name="description" content="RESAMPLEDATA Resample dataset according to a given timestep.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="../../index.html">OpenBDLM_V1.0</a> &gt; <a href="#">functions</a> &gt; <a href="index.html">DataLoader</a> &gt; resampleData.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for OpenBDLM_V1.0/functions/DataLoader&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>resampleData
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>RESAMPLEDATA Resample dataset according to a given timestep.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function [data_resample, misc]=resampleData(data, misc, varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">RESAMPLEDATA Resample dataset according to a given timestep.

   SYNOPSIS:
     [data, misc]=RESAMPLEDATA(data, misc, varargin)

   INPUT:
       data            - structure (required)
                         data must contain three fields:

                               'timestamps' is a M×1 array

                               'values' is a MxN  array

                               'labels' is a 1×N cell array
                               each cell is a character array

                               N: number of time series
                               M: number of samples

       misc            - structure
                           see the documentation for details about the
                           field in misc

      Timestep         - real (optionnal)
                         requested timestep (in days)
                         default: 1 day
   OUTPUT:
      data_resample    - structure 
                         data must contain three fields:

                               'timestamps' is a M×1 array

                               'values' is a MxN  array

                               'labels' is a 1×N cell array
                               each cell is a character array

                               N: number of time series
                               M: number of samples

     misc              - structure
                           see the documentation for details about the
                           field in misc

   DESCRIPTION:
      RESAMPLEDATA resamples dataset according to a given timestep.
      For each time series, RESAMPLEDATA computes the mean of the values 
      (ignoring missing value) in a fixed length window of length
      corresponding to the requested timestep.

      For non-uniform input timestamp vector, the number of values used to
      computed the mean in each time window can be different.

      RESAMPLEDATA add missing data (NaN) where no data are available to
      compute the mean.

   EXAMPLES:
      [data, misc]=RESAMPLEDATA(data, misc)
      [data, misc]=RESAMPLEDATA(data, misc, 'Timestep', 10)
      [data, misc]=RESAMPLEDATA(data, misc, 'Timestep', 0.041667)

   EXTERNAL FUNCTIONS CALLED:
      verificationMergedDataset, mergeTimeStampVectors

   SUBFUNCTIONS:
      N/A

   See also <a href="editData.html" class="code" title="function [data, misc, dataFilename]=editData(data, misc, varargin)">EDITDATA</a>, <a href="mergeTimeStampVectors.html" class="code" title="function [data, misc]=mergeTimeStampVectors(dataOrig, misc, varargin)">MERGETIMESTAMPVECTORS</a>, <a href="verificationMergedDataset.html" class="code" title="function [isMerged]=verificationMergedDataset(data)">VERIFICATIONMERGEDDATASET</a></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="mergeTimeStampVectors.html" class="code" title="function [data, misc]=mergeTimeStampVectors(dataOrig, misc, varargin)">mergeTimeStampVectors</a>	MERGETIMESTAMPVECTORS Create a single time vector from a set of time series</li><li><a href="../../../OpenBDLM_V1.0/functions/Others/convertCell2Mat.html" class="code" title="function [data]=convertCell2Mat(data)">convertCell2Mat</a>	CONVERTCELL2MAT Convert cells in data.timestamps and data.values to array</li><li><a href="../../../OpenBDLM_V1.0/functions/Others/convertMat2Cell.html" class="code" title="function [data]=convertMat2Cell(data)">convertMat2Cell</a>	CONVERTMAT2CELL Convert matrices in data.timestamps and data.values to cell array</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="editData.html" class="code" title="function [data, misc, dataFilename]=editData(data, misc, varargin)">editData</a>	EDITDATA Control script to edit dataset (selection, resampling, etc..)</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [data_resample, misc]=resampleData(data, misc, varargin)</a>
0002 <span class="comment">%RESAMPLEDATA Resample dataset according to a given timestep.</span>
0003 <span class="comment">%</span>
0004 <span class="comment">%   SYNOPSIS:</span>
0005 <span class="comment">%     [data, misc]=RESAMPLEDATA(data, misc, varargin)</span>
0006 <span class="comment">%</span>
0007 <span class="comment">%   INPUT:</span>
0008 <span class="comment">%       data            - structure (required)</span>
0009 <span class="comment">%                         data must contain three fields:</span>
0010 <span class="comment">%</span>
0011 <span class="comment">%                               'timestamps' is a M×1 array</span>
0012 <span class="comment">%</span>
0013 <span class="comment">%                               'values' is a MxN  array</span>
0014 <span class="comment">%</span>
0015 <span class="comment">%                               'labels' is a 1×N cell array</span>
0016 <span class="comment">%                               each cell is a character array</span>
0017 <span class="comment">%</span>
0018 <span class="comment">%                               N: number of time series</span>
0019 <span class="comment">%                               M: number of samples</span>
0020 <span class="comment">%</span>
0021 <span class="comment">%       misc            - structure</span>
0022 <span class="comment">%                           see the documentation for details about the</span>
0023 <span class="comment">%                           field in misc</span>
0024 <span class="comment">%</span>
0025 <span class="comment">%      Timestep         - real (optionnal)</span>
0026 <span class="comment">%                         requested timestep (in days)</span>
0027 <span class="comment">%                         default: 1 day</span>
0028 <span class="comment">%   OUTPUT:</span>
0029 <span class="comment">%      data_resample    - structure</span>
0030 <span class="comment">%                         data must contain three fields:</span>
0031 <span class="comment">%</span>
0032 <span class="comment">%                               'timestamps' is a M×1 array</span>
0033 <span class="comment">%</span>
0034 <span class="comment">%                               'values' is a MxN  array</span>
0035 <span class="comment">%</span>
0036 <span class="comment">%                               'labels' is a 1×N cell array</span>
0037 <span class="comment">%                               each cell is a character array</span>
0038 <span class="comment">%</span>
0039 <span class="comment">%                               N: number of time series</span>
0040 <span class="comment">%                               M: number of samples</span>
0041 <span class="comment">%</span>
0042 <span class="comment">%     misc              - structure</span>
0043 <span class="comment">%                           see the documentation for details about the</span>
0044 <span class="comment">%                           field in misc</span>
0045 <span class="comment">%</span>
0046 <span class="comment">%   DESCRIPTION:</span>
0047 <span class="comment">%      RESAMPLEDATA resamples dataset according to a given timestep.</span>
0048 <span class="comment">%      For each time series, RESAMPLEDATA computes the mean of the values</span>
0049 <span class="comment">%      (ignoring missing value) in a fixed length window of length</span>
0050 <span class="comment">%      corresponding to the requested timestep.</span>
0051 <span class="comment">%</span>
0052 <span class="comment">%      For non-uniform input timestamp vector, the number of values used to</span>
0053 <span class="comment">%      computed the mean in each time window can be different.</span>
0054 <span class="comment">%</span>
0055 <span class="comment">%      RESAMPLEDATA add missing data (NaN) where no data are available to</span>
0056 <span class="comment">%      compute the mean.</span>
0057 <span class="comment">%</span>
0058 <span class="comment">%   EXAMPLES:</span>
0059 <span class="comment">%      [data, misc]=RESAMPLEDATA(data, misc)</span>
0060 <span class="comment">%      [data, misc]=RESAMPLEDATA(data, misc, 'Timestep', 10)</span>
0061 <span class="comment">%      [data, misc]=RESAMPLEDATA(data, misc, 'Timestep', 0.041667)</span>
0062 <span class="comment">%</span>
0063 <span class="comment">%   EXTERNAL FUNCTIONS CALLED:</span>
0064 <span class="comment">%      verificationMergedDataset, mergeTimeStampVectors</span>
0065 <span class="comment">%</span>
0066 <span class="comment">%   SUBFUNCTIONS:</span>
0067 <span class="comment">%      N/A</span>
0068 <span class="comment">%</span>
0069 <span class="comment">%   See also EDITDATA, MERGETIMESTAMPVECTORS, VERIFICATIONMERGEDDATASET</span>
0070 
0071 <span class="comment">%   AUTHORS:</span>
0072 <span class="comment">%       Ianis Gaudot, Luong Ha Nguyen,  James-A Goulet,</span>
0073 <span class="comment">%</span>
0074 <span class="comment">%      Email: &lt;james.goulet@polymtl.ca&gt;</span>
0075 <span class="comment">%      Website: &lt;http://www.polymtl.ca/expertises/goulet-james-alexandre&gt;</span>
0076 <span class="comment">%</span>
0077 <span class="comment">%   MATLAB VERSION:</span>
0078 <span class="comment">%      Tested on 9.1.0.441655 (R2016b)</span>
0079 <span class="comment">%</span>
0080 <span class="comment">%   DATE CREATED:</span>
0081 <span class="comment">%       July 5, 2018</span>
0082 <span class="comment">%</span>
0083 <span class="comment">%   DATE LAST UPDATE:</span>
0084 <span class="comment">%       July 24, 2018</span>
0085 
0086 <span class="comment">%--------------------BEGIN CODE ----------------------</span>
0087 
0088 <span class="comment">%% Get arguments passed to the function and proceed to some verifications</span>
0089 p = inputParser;
0090 
0091 validationFct_Timestep = @(x) isnumeric(x) &amp;&amp; length(x)==1;
0092 
0093 defaultTimestep = 1;
0094 
0095 addRequired(p,<span class="string">'data'</span>, @isstruct );
0096 addRequired(p,<span class="string">'misc'</span>, @isstruct );
0097 addParameter(p, <span class="string">'Timestep'</span>,defaultTimestep, validationFct_Timestep)
0098 parse(p,data, misc, varargin{:});
0099 
0100 data=p.Results.data;
0101 misc=p.Results.misc;
0102 dt_ref=p.Results.Timestep;
0103 
0104 <span class="comment">%% Get number of time series</span>
0105 
0106 numberOfTimeSeries =size(data.values, 2);
0107 
0108 <span class="comment">%% Convert data structure from array to cell</span>
0109 [dataCell]=<a href="../../../OpenBDLM_V1.0/functions/Others/convertMat2Cell.html" class="code" title="function [data]=convertMat2Cell(data)">convertMat2Cell</a>(data);
0110 
0111 <span class="comment">%% Get unique timestamps vector</span>
0112 timestamps=dataCell.timestamps{1};
0113 
0114 <span class="comment">%% Get beg and endd date corresponding to the first and last sample</span>
0115 
0116 begg = timestamps(1);
0117 endd = timestamps(end);
0118 
0119 <span class="comment">%% Generate reference uniform timestamp vector with requested timestep</span>
0120 
0121 timestamps_ref = begg:dt_ref:endd;
0122 timestamps_ref=timestamps_ref';
0123 values_ref = zeros(length(timestamps_ref),1);
0124 
0125 <span class="comment">%% Add reference timestamps, reference values, and reference labels to</span>
0126 <span class="comment">%% the original dataset</span>
0127 dataCell.timestamps = [timestamps_ref {dataCell.timestamps{:}}];
0128 dataCell.values=[values_ref {dataCell.values{:}}];
0129 dataCell.labels=[<span class="string">'reference'</span> {dataCell.labels{:}}];
0130 
0131 <span class="comment">%% Merge dataset</span>
0132 [data, misc] = <a href="mergeTimeStampVectors.html" class="code" title="function [data, misc]=mergeTimeStampVectors(dataOrig, misc, varargin)">mergeTimeStampVectors</a>(dataCell, misc, <span class="string">'NaNThreshold'</span>, 100);
0133 
0134 <span class="comment">%% Convert data structure from array to cell</span>
0135 [dataCell]=<a href="../../../OpenBDLM_V1.0/functions/Others/convertMat2Cell.html" class="code" title="function [data]=convertMat2Cell(data)">convertMat2Cell</a>(data);
0136 
0137 <span class="comment">%% Remove reference timestamps, reference values, and reference labels to</span>
0138 <span class="comment">%% the original dataset</span>
0139 dataCell.timestamps{1}=[];
0140 dataCell.timestamps=dataCell.timestamps(~cellfun(@isempty, dataCell.timestamps));
0141 
0142 dataCell.values{1}=[];
0143 dataCell.values=dataCell.values(~cellfun(@isempty, dataCell.values));
0144 
0145 dataCell.labels{1}=[];
0146 dataCell.labels=dataCell.labels(~cellfun(@isempty, dataCell.labels));
0147 
0148 <span class="comment">%% Get new unique timestamps vector</span>
0149 timestamps=dataCell.timestamps{1};
0150 
0151 <span class="comment">%% Compute mean value over fixed window of length dt_ref</span>
0152  <span class="keyword">for</span> i=1:length(timestamps_ref)-1
0153 
0154      idx = timestamps &gt;= timestamps_ref(i) &amp; timestamps &lt; timestamps_ref(i+1);
0155      
0156      <span class="keyword">for</span> j=1:numberOfTimeSeries
0157          data_resampleCell.values{j}(i)=nanmean(dataCell.values{j}(idx));
0158      <span class="keyword">end</span>
0159      
0160  <span class="keyword">end</span>
0161 
0162 <span class="comment">%% Create new timestamp vector and labels</span>
0163 <span class="keyword">for</span> j=1:numberOfTimeSeries
0164          data_resampleCell.timestamps{j}=timestamps_ref(1:end-1)+dt_ref/2;
0165          data_resampleCell.values{j}=data_resampleCell.values{j}';
0166          data_resampleCell.labels{j}=dataCell.labels{j};
0167 <span class="keyword">end</span>
0168 
0169 <span class="comment">%% Convert cell to mat</span>
0170 [data_resample]=<a href="../../../OpenBDLM_V1.0/functions/Others/convertCell2Mat.html" class="code" title="function [data]=convertCell2Mat(data)">convertCell2Mat</a>(data_resampleCell);
0171 
0172 <span class="comment">%--------------------END CODE ------------------------</span>
0173 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Tue 05-Feb-2019 11:23:52 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>