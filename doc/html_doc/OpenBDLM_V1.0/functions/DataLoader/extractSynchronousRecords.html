<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of extractSynchronousRecords</title>
  <meta name="keywords" content="extractSynchronousRecords">
  <meta name="description" content="EXTRACTSYNCHRONOUSRECORDS Extract synchronous records among time series">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="../../index.html">OpenBDLM_V1.0</a> &gt; <a href="#">functions</a> &gt; <a href="index.html">DataLoader</a> &gt; extractSynchronousRecords.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for OpenBDLM_V1.0/functions/DataLoader&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>extractSynchronousRecords
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>EXTRACTSYNCHRONOUSRECORDS Extract synchronous records among time series</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function [data, misc]=extractSynchronousRecords(data, misc, varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">EXTRACTSYNCHRONOUSRECORDS Extract synchronous records among time series

   SYNOPSIS:
     [data, misc]=EXTRACTSYNCHRONOUSRECORDS(data, misc, varargin)

   INPUT:
      data       - structure (required)
                      data must contain three fields :

                           'timestamps' is a 1×N cell array
                           each cell is a M_ix1 real array

                           'values' is a 1×N cell array
                           each cell is a M_ix1 real array

                           'labels' is a 1×N cell array
                           each cell is a character array

                 N: number of time series
                 M_i: number of samples of time series i

      isOutputFile - logical (optional)
                     if true, save the data in a DATA_*.mat Matlab file
                     default: false

      isPlot       - logical (optional)
                     if true, plot data
                     default: false

      misc         - structure
                     see the documentation for details about the
                     field in misc
   OUTPUT:
      data       - structure
                   fields of data are timestamps, values, labels

      misc         - structure
                     see the documentation for details about the
                     field in misc
   DESCRIPTION:
      EXTRACTSYNCHRONOUSRECORDS extracts synchronous records among time
      series
      It may happen that several set of synchronous records exist.
      Example with N=4 time series:
                A
      1 -----|---|   B   C
      2      |---|-|---|--|  D
      3                |--|----|-------
      4            |---|--|----|

      4 synchronous ranges, labeled A, B, C, D

      In such case, EXTRACTSYNCHRONOUSRECORDS proceeds as follows:
      1) Select the synchronous record that includes the maximum of the
      time series
      2) If 1) is not discriminant criterion, select the longest synchronous
      record.

      Consequently, EXTRACTSYNCHRONOUSRECORDS would select range C.
      Data from time series #2,#3,#4 during time range C would be retained.

   EXAMPLES:
      [data, misc] = EXTRACTSYNCHRONOUSRECORDS(data, misc)
      [data, misc] = EXTRACTSYNCHRONOUSRECORDS(data, misc, 'isPlot', true, 'isOutpufile', true)
      [data, misc] = EXTRACTSYNCHRONOUSRECORDS(data, misc, 'isPlot', true)

   EXTERNAL FUNCTIONS CALLED:
      verificationDataStructure

   See also <a href="getTimeOverlap.html" class="code" title="function [OverlapRange, Index]=getTimeOverlap(Start_End)">GETTIMEOVERLAP</a>, <a href="verificationDataStructure.html" class="code" title="function [isValid]=verificationDataStructure(data)">VERIFICATIONDATASTRUCTURE</a>,
      <a href="mergeTimeStampVectors.html" class="code" title="function [data, misc]=mergeTimeStampVectors(dataOrig, misc, varargin)">MERGETIMESTAMPVECTORS</a></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="getTimeOverlap.html" class="code" title="function [OverlapRange, Index]=getTimeOverlap(Start_End)">getTimeOverlap</a>	GETTIMEOVERLAP Detect time overlap range among a set of start/end dates</li><li><a href="verificationDataStructure.html" class="code" title="function [isValid]=verificationDataStructure(data)">verificationDataStructure</a>	VERIFICATIONDATASTRUCTURE Verify formatting of data structure</li><li><a href="../../../OpenBDLM_V1.0/functions/Others/saveDataBinary.html" class="code" title="function [misc, dataFilename] = saveDataBinary(data, misc, varargin)">saveDataBinary</a>	SAVEDATABINARY Save data in a binary Matlab .mat file</li><li><a href="../../../OpenBDLM_V1.0/functions/VisualizationTools/plotData.html" class="code" title="function [FigureNames] = plotData(data, misc, varargin)">plotData</a>	PLOTDATA Plot data amplitude values and data timestep</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [data, misc]=extractSynchronousRecords(data, misc, varargin)</a>
0002 <span class="comment">%EXTRACTSYNCHRONOUSRECORDS Extract synchronous records among time series</span>
0003 <span class="comment">%</span>
0004 <span class="comment">%   SYNOPSIS:</span>
0005 <span class="comment">%     [data, misc]=EXTRACTSYNCHRONOUSRECORDS(data, misc, varargin)</span>
0006 <span class="comment">%</span>
0007 <span class="comment">%   INPUT:</span>
0008 <span class="comment">%      data       - structure (required)</span>
0009 <span class="comment">%                      data must contain three fields :</span>
0010 <span class="comment">%</span>
0011 <span class="comment">%                           'timestamps' is a 1×N cell array</span>
0012 <span class="comment">%                           each cell is a M_ix1 real array</span>
0013 <span class="comment">%</span>
0014 <span class="comment">%                           'values' is a 1×N cell array</span>
0015 <span class="comment">%                           each cell is a M_ix1 real array</span>
0016 <span class="comment">%</span>
0017 <span class="comment">%                           'labels' is a 1×N cell array</span>
0018 <span class="comment">%                           each cell is a character array</span>
0019 <span class="comment">%</span>
0020 <span class="comment">%                 N: number of time series</span>
0021 <span class="comment">%                 M_i: number of samples of time series i</span>
0022 <span class="comment">%</span>
0023 <span class="comment">%      isOutputFile - logical (optional)</span>
0024 <span class="comment">%                     if true, save the data in a DATA_*.mat Matlab file</span>
0025 <span class="comment">%                     default: false</span>
0026 <span class="comment">%</span>
0027 <span class="comment">%      isPlot       - logical (optional)</span>
0028 <span class="comment">%                     if true, plot data</span>
0029 <span class="comment">%                     default: false</span>
0030 <span class="comment">%</span>
0031 <span class="comment">%      misc         - structure</span>
0032 <span class="comment">%                     see the documentation for details about the</span>
0033 <span class="comment">%                     field in misc</span>
0034 <span class="comment">%   OUTPUT:</span>
0035 <span class="comment">%      data       - structure</span>
0036 <span class="comment">%                   fields of data are timestamps, values, labels</span>
0037 <span class="comment">%</span>
0038 <span class="comment">%      misc         - structure</span>
0039 <span class="comment">%                     see the documentation for details about the</span>
0040 <span class="comment">%                     field in misc</span>
0041 <span class="comment">%   DESCRIPTION:</span>
0042 <span class="comment">%      EXTRACTSYNCHRONOUSRECORDS extracts synchronous records among time</span>
0043 <span class="comment">%      series</span>
0044 <span class="comment">%      It may happen that several set of synchronous records exist.</span>
0045 <span class="comment">%      Example with N=4 time series:</span>
0046 <span class="comment">%                A</span>
0047 <span class="comment">%      1 -----|---|   B   C</span>
0048 <span class="comment">%      2      |---|-|---|--|  D</span>
0049 <span class="comment">%      3                |--|----|-------</span>
0050 <span class="comment">%      4            |---|--|----|</span>
0051 <span class="comment">%</span>
0052 <span class="comment">%      4 synchronous ranges, labeled A, B, C, D</span>
0053 <span class="comment">%</span>
0054 <span class="comment">%      In such case, EXTRACTSYNCHRONOUSRECORDS proceeds as follows:</span>
0055 <span class="comment">%      1) Select the synchronous record that includes the maximum of the</span>
0056 <span class="comment">%      time series</span>
0057 <span class="comment">%      2) If 1) is not discriminant criterion, select the longest synchronous</span>
0058 <span class="comment">%      record.</span>
0059 <span class="comment">%</span>
0060 <span class="comment">%      Consequently, EXTRACTSYNCHRONOUSRECORDS would select range C.</span>
0061 <span class="comment">%      Data from time series #2,#3,#4 during time range C would be retained.</span>
0062 <span class="comment">%</span>
0063 <span class="comment">%   EXAMPLES:</span>
0064 <span class="comment">%      [data, misc] = EXTRACTSYNCHRONOUSRECORDS(data, misc)</span>
0065 <span class="comment">%      [data, misc] = EXTRACTSYNCHRONOUSRECORDS(data, misc, 'isPlot', true, 'isOutpufile', true)</span>
0066 <span class="comment">%      [data, misc] = EXTRACTSYNCHRONOUSRECORDS(data, misc, 'isPlot', true)</span>
0067 <span class="comment">%</span>
0068 <span class="comment">%   EXTERNAL FUNCTIONS CALLED:</span>
0069 <span class="comment">%      verificationDataStructure</span>
0070 <span class="comment">%</span>
0071 <span class="comment">%   See also GETTIMEOVERLAP, VERIFICATIONDATASTRUCTURE,</span>
0072 <span class="comment">%      MERGETIMESTAMPVECTORS</span>
0073 
0074 <span class="comment">%   AUTHORS:</span>
0075 <span class="comment">%      Ianis Gaudot, Luong Ha Nguyen, James-A Goulet</span>
0076 <span class="comment">%</span>
0077 <span class="comment">%      Email: &lt;james.goulet@polymtl.ca&gt;</span>
0078 <span class="comment">%      Website: &lt;http://www.polymtl.ca/expertises/goulet-james-alexandre&gt;</span>
0079 <span class="comment">%</span>
0080 <span class="comment">%   MATLAB VERSION:</span>
0081 <span class="comment">%      Tested on 9.1.0.441655 (R2016b)</span>
0082 <span class="comment">%</span>
0083 <span class="comment">%   DATE CREATED:</span>
0084 <span class="comment">%       April 13, 2018</span>
0085 <span class="comment">%</span>
0086 <span class="comment">%   DATE LAST UPDATE:</span>
0087 <span class="comment">%       July 20, 2018</span>
0088 
0089 <span class="comment">%--------------------BEGIN CODE ----------------------</span>
0090 <span class="comment">%% Get arguments passed to the function and proceed to some verifications</span>
0091 
0092 p = inputParser;
0093 defaultisOutputFile = false;
0094 defaultisPlot = false;
0095 
0096 addRequired(p,<span class="string">'data'</span>, @isstruct );
0097 addRequired(p,<span class="string">'misc'</span>, @isstruct );
0098 addParameter(p,<span class="string">'isOutputFile'</span>,defaultisOutputFile,@islogical);
0099 addParameter(p,<span class="string">'isPlot'</span>,defaultisPlot,@islogical);
0100 
0101 parse(p,data, misc, varargin{:} );
0102 
0103 data=p.Results.data;
0104 misc=p.Results.misc;
0105 isOutputFile=p.Results.isOutputFile;
0106 isPlot=p.Results.isPlot;
0107 
0108 <span class="comment">% Validation of structure data</span>
0109 isValid = <a href="verificationDataStructure.html" class="code" title="function [isValid]=verificationDataStructure(data)">verificationDataStructure</a>(data);
0110 <span class="keyword">if</span> ~isValid
0111     disp(<span class="string">' '</span>)
0112     disp(<span class="string">'ERROR: Unable to read the data from the structure.'</span>)
0113     disp(<span class="string">' '</span>)
0114     <span class="keyword">return</span>
0115 <span class="keyword">end</span>
0116 
0117 
0118 <span class="comment">%% Get number of time series</span>
0119 numberOfTimeSeries = length(data.values);
0120 
0121 <span class="comment">%% Get start and end date of each time series</span>
0122 Start_End=zeros(numberOfTimeSeries,2);
0123 
0124 <span class="keyword">for</span> i = 1:numberOfTimeSeries
0125     Start_End(i,1)=data.timestamps{i}(1); <span class="comment">% get beg</span>
0126     Start_End(i,2)=data.timestamps{i}(end); <span class="comment">% get end</span>
0127 <span class="keyword">end</span>
0128 
0129 <span class="comment">%% Get time overlap</span>
0130 [DetectedOverlap, Index] = <a href="getTimeOverlap.html" class="code" title="function [OverlapRange, Index]=getTimeOverlap(Start_End)">getTimeOverlap</a>(Start_End);
0131 
0132 <span class="comment">%% Remove time series which do not participate to detected overlap</span>
0133 <span class="comment">% overwrite data structure</span>
0134 data.timestamps = data.timestamps(Index);
0135 data.values = data.values(Index);
0136 data.labels = data.labels(Index);
0137 
0138 <span class="comment">%% Get new number of time series</span>
0139 numberOfTimeSeries = length(data.values);
0140 
0141 <span class="comment">%% Select data between overlap range</span>
0142 
0143 <span class="keyword">for</span> i = 1:numberOfTimeSeries
0144     
0145     <span class="comment">% select samples that lie between start and end of the detected overlap</span>
0146     selection = data.timestamps{i}(:) &gt;= DetectedOverlap(1) &amp; <span class="keyword">...</span>
0147         data.timestamps{i}(:) &lt;= DetectedOverlap(2) ;
0148     
0149     data.timestamps{i} = data.timestamps{i}(selection);
0150     data.values{i} = data.values{i}(selection);
0151     
0152 <span class="keyword">end</span>
0153 
0154 <span class="keyword">if</span> isOutputFile ==  true
0155     [misc, ~] = <a href="../../../OpenBDLM_V1.0/functions/Others/saveDataBinary.html" class="code" title="function [misc, dataFilename] = saveDataBinary(data, misc, varargin)">saveDataBinary</a>(data, <span class="string">'FilePath'</span>,<span class="string">'processed_data'</span>);
0156 <span class="keyword">end</span>
0157 
0158 <span class="keyword">if</span> isPlot == true
0159     <a href="../../../OpenBDLM_V1.0/functions/VisualizationTools/plotData.html" class="code" title="function [FigureNames] = plotData(data, misc, varargin)">plotData</a>(data, <span class="string">'FigurePath'</span>, <span class="string">'figures'</span>)
0160 <span class="keyword">end</span>
0161 
0162 <span class="comment">%--------------------END CODE ------------------------</span>
0163 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Tue 05-Feb-2019 11:23:52 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>