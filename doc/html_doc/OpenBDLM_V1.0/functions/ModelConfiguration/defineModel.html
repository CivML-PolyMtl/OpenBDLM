<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of defineModel</title>
  <meta name="keywords" content="defineModel">
  <meta name="description" content="DEFINEMODEL Request user's input to define model">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="../../index.html">OpenBDLM_V1.0</a> &gt; <a href="#">functions</a> &gt; <a href="index.html">ModelConfiguration</a> &gt; defineModel.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for OpenBDLM_V1.0/functions/ModelConfiguration&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>defineModel
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>DEFINEMODEL Request user's input to define model</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function [model, misc]=defineModel(data, misc) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">DEFINEMODEL Request user's input to define model

   SYNOPSIS:
     [model, misc]=DEFINEMODEL(data, misc)

   INPUT:
      data                - structure (required)
                            data contains three fields :

                              'timestamps' is a 1×N cell array
                              each cell is a M_ix1 real array

                              'values' is a 1×N cell array
                              each cell is a M_ix1 real array

                              'labels' is a 1×N cell array
                              each cell is a character array

                    N: number of time series
                    M_i: number of samples of time series i

      misc                - structure (required)
                            see documentation for details about the fields
                            in structure &quot;misc&quot;

   OUTPUT:
      model               - structure
                            see documentation for details about the fields
                            in structure &quot;model&quot;

      misc                - structure (required)
                            see documentation for details about the fields
                            in structure &quot;misc&quot;

   DESCRIPTION:
      DEFINEMODEL requests user's input to define model

   EXAMPLES:
      [model, misc]=DEFINEMODEL(data, misc)

   EXTERNAL FUNCTIONS CALLED:
      N/A

   See also <a href="ModelConfiguration.html" class="code" title="function [data, model, estimation, misc]=ModelConfiguration(data, model, estimation, misc)">MODELCONFIGURATION</a>, <a href="configureModelForDataReal.html" class="code" title="function [data, model, estimation, misc]=configureModelForDataReal(data, model, estimation , misc)">CONFIGUREMODELFORDATAREAL</a>,
            <a href="configureModelForDataSimulation.html" class="code" title="function [data, model, estimation, misc]=configureModelForDataSimulation(data, model, estimation , misc)">CONFIGUREMODELFORDATASIMULATION</a></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../OpenBDLM_V1.0/functions/DataLoader/displayData.html" class="code" title="function displayData(data, misc)">displayData</a>	DISPLAYDATA Display on screen the content of the data in memory</li><li><a href="../../../OpenBDLM_V1.0/functions/DataLoader/verificationDataStructure.html" class="code" title="function [isValid]=verificationDataStructure(data)">verificationDataStructure</a>	VERIFICATIONDATASTRUCTURE Verify formatting of data structure</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="configureModelForDataReal.html" class="code" title="function [data, model, estimation, misc]=configureModelForDataReal(data, model, estimation , misc)">configureModelForDataReal</a>	CONFIGUREMODELFORDATAREAL Configure model for BDLM analysis based on real data</li><li><a href="configureModelForDataSimulation.html" class="code" title="function [data, model, estimation, misc]=configureModelForDataSimulation(data, model, estimation , misc)">configureModelForDataSimulation</a>	CONFIGUREMODELFORDATASIMULATION Configure model for BDLM analysis based on simulated data</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [model, misc]=defineModel(data, misc)</a>
0002 <span class="comment">%DEFINEMODEL Request user's input to define model</span>
0003 <span class="comment">%</span>
0004 <span class="comment">%   SYNOPSIS:</span>
0005 <span class="comment">%     [model, misc]=DEFINEMODEL(data, misc)</span>
0006 <span class="comment">%</span>
0007 <span class="comment">%   INPUT:</span>
0008 <span class="comment">%      data                - structure (required)</span>
0009 <span class="comment">%                            data contains three fields :</span>
0010 <span class="comment">%</span>
0011 <span class="comment">%                              'timestamps' is a 1×N cell array</span>
0012 <span class="comment">%                              each cell is a M_ix1 real array</span>
0013 <span class="comment">%</span>
0014 <span class="comment">%                              'values' is a 1×N cell array</span>
0015 <span class="comment">%                              each cell is a M_ix1 real array</span>
0016 <span class="comment">%</span>
0017 <span class="comment">%                              'labels' is a 1×N cell array</span>
0018 <span class="comment">%                              each cell is a character array</span>
0019 <span class="comment">%</span>
0020 <span class="comment">%                    N: number of time series</span>
0021 <span class="comment">%                    M_i: number of samples of time series i</span>
0022 <span class="comment">%</span>
0023 <span class="comment">%      misc                - structure (required)</span>
0024 <span class="comment">%                            see documentation for details about the fields</span>
0025 <span class="comment">%                            in structure &quot;misc&quot;</span>
0026 <span class="comment">%</span>
0027 <span class="comment">%   OUTPUT:</span>
0028 <span class="comment">%      model               - structure</span>
0029 <span class="comment">%                            see documentation for details about the fields</span>
0030 <span class="comment">%                            in structure &quot;model&quot;</span>
0031 <span class="comment">%</span>
0032 <span class="comment">%      misc                - structure (required)</span>
0033 <span class="comment">%                            see documentation for details about the fields</span>
0034 <span class="comment">%                            in structure &quot;misc&quot;</span>
0035 <span class="comment">%</span>
0036 <span class="comment">%   DESCRIPTION:</span>
0037 <span class="comment">%      DEFINEMODEL requests user's input to define model</span>
0038 <span class="comment">%</span>
0039 <span class="comment">%   EXAMPLES:</span>
0040 <span class="comment">%      [model, misc]=DEFINEMODEL(data, misc)</span>
0041 <span class="comment">%</span>
0042 <span class="comment">%   EXTERNAL FUNCTIONS CALLED:</span>
0043 <span class="comment">%      N/A</span>
0044 <span class="comment">%</span>
0045 <span class="comment">%   See also MODELCONFIGURATION, CONFIGUREMODELFORDATAREAL,</span>
0046 <span class="comment">%            CONFIGUREMODELFORDATASIMULATION</span>
0047 
0048 <span class="comment">%   AUTHORS:</span>
0049 <span class="comment">%      Ianis Gaudot, Luong Ha Nguyen, James-A Goulet</span>
0050 <span class="comment">%</span>
0051 <span class="comment">%      Email: &lt;james.goulet@polymtl.ca&gt;</span>
0052 <span class="comment">%      Website: &lt;http://www.polymtl.ca/expertises/goulet-james-alexandre&gt;</span>
0053 <span class="comment">%</span>
0054 <span class="comment">%   MATLAB VERSION:</span>
0055 <span class="comment">%      Tested on 9.1.0.441655 (R2016b)</span>
0056 <span class="comment">%</span>
0057 <span class="comment">%   DATE CREATED:</span>
0058 <span class="comment">%       April 20, 2018</span>
0059 <span class="comment">%</span>
0060 <span class="comment">%   DATE LAST UPDATE:</span>
0061 <span class="comment">%       December 3, 2018</span>
0062 
0063 <span class="comment">%--------------------BEGIN CODE ----------------------</span>
0064 <span class="comment">%% Get arguments passed to the function and proceed to some verifications</span>
0065 p = inputParser;
0066 
0067 addRequired(p,<span class="string">'data'</span>, @isstruct );
0068 addRequired(p,<span class="string">'misc'</span>, @isstruct );
0069 parse(p,data, misc);
0070 
0071 data=p.Results.data;
0072 misc=p.Results.misc;
0073 
0074 MaxFailAttempts = 4;
0075 
0076 <span class="comment">% Set fileID for logfile</span>
0077 <span class="keyword">if</span> misc.internalVars.isQuiet
0078     <span class="comment">% output message in logfile</span>
0079     fileID=fopen(misc.internalVars.logFileName, <span class="string">'a'</span>);
0080 <span class="keyword">else</span>
0081     <span class="comment">% output message on screen and logfile using diary command</span>
0082     fileID=1;
0083 <span class="keyword">end</span>
0084 
0085 <span class="keyword">if</span> ~misc.internalVars.isDataSimulation
0086     <span class="comment">% Validation of structure data</span>
0087     isValid = <a href="../../../OpenBDLM_V1.0/functions/DataLoader/verificationDataStructure.html" class="code" title="function [isValid]=verificationDataStructure(data)">verificationDataStructure</a>(data);
0088     <span class="keyword">if</span> ~isValid
0089         disp (<span class="string">' '</span>)
0090         error(<span class="string">'Unable to read the data from the structure.\n'</span>);
0091     <span class="keyword">end</span>
0092 <span class="keyword">end</span>
0093 
0094 <span class="comment">% display loaded data</span>
0095 <a href="../../../OpenBDLM_V1.0/functions/DataLoader/displayData.html" class="code" title="function displayData(data, misc)">displayData</a>(data, misc)
0096 
0097 <span class="comment">% Get number of time series in dataset</span>
0098 numberOfTimeSeries = length(data.labels);
0099 
0100 <span class="comment">%% Define time series dependencies</span>
0101 <span class="keyword">if</span> numberOfTimeSeries &gt; 1
0102     
0103     ForbiddenIndexes=cell(numberOfTimeSeries,1);
0104     
0105     <span class="keyword">for</span> i=1:numberOfTimeSeries
0106         ForbiddenIndexes{i} = i;
0107     <span class="keyword">end</span>
0108     
0109     comp_ic = cell(1,numberOfTimeSeries);
0110         
0111     <span class="keyword">for</span> i=1:numberOfTimeSeries
0112         
0113         incTest=0;
0114         isCorrect=false;
0115         <span class="keyword">while</span> ~isCorrect
0116             
0117             incTest=incTest+1;
0118             <span class="keyword">if</span> incTest &gt; MaxFailAttempts ; error([<span class="string">'Too many failed '</span>, <span class="keyword">...</span>
0119                     <span class="string">'attempts ('</span>, num2str(MaxFailAttempts)  <span class="string">').'</span>]) ; <span class="keyword">end</span>
0120             fprintf(fileID,<span class="string">'\n'</span>);
0121             fprintf(fileID,[<span class="string">'- Identifies dependence between'</span> <span class="keyword">...</span>
0122                 <span class="string">' time series; use [0] to indicate no dependence\n'</span>]);
0123             <span class="keyword">if</span> misc.internalVars.BatchMode.isBatchMode
0124                 comp_ic{1,i}=eval(char(misc.internalVars.BatchMode.Answers{<span class="keyword">...</span>
0125                     misc.internalVars.BatchMode.AnswerIndex}));
0126                 
0127                 fprintf(fileID, [<span class="string">'     [%s] '</span>, <span class="keyword">...</span>
0128                     <span class="string">'\n'</span>], strjoin(cellstr(num2str(comp_ic{1,i}(:))),<span class="string">', '</span>));
0129                 
0130             <span class="keyword">else</span>
0131                 comp_ic{1,i}=input([<span class="string">'    time serie #'</span> num2str(i) <span class="keyword">...</span>
0132                     <span class="string">' depends on time series # &gt;&gt; '</span>]);
0133             <span class="keyword">end</span>
0134             
0135             <span class="keyword">if</span> ~isempty(comp_ic{1,i})
0136                 <span class="keyword">for</span> j=1:length(comp_ic{1,i})
0137                     <span class="keyword">try</span>
0138                         ForbiddenIndexes{comp_ic{1,i}(j)}=  <span class="keyword">...</span>
0139                             [i ForbiddenIndexes{comp_ic{1,i}(j)} ];
0140                     <span class="keyword">catch</span>
0141                     <span class="keyword">end</span>
0142                 <span class="keyword">end</span>
0143             <span class="keyword">end</span>
0144             
0145             <span class="keyword">if</span> isempty(comp_ic{1,i})
0146                 <span class="keyword">continue</span>
0147             <span class="keyword">elseif</span> ischar(comp_ic{1,i})
0148                 fprintf(fileID,<span class="string">'\n'</span>);
0149                 fprintf(fileID,<span class="string">'     wrong input -&gt; should be integers\n'</span>);
0150                 fprintf(fileID,<span class="string">'\n'</span>);
0151                 <span class="keyword">continue</span>
0152             <span class="keyword">elseif</span> ~isempty(comp_ic{1,i}) &amp;&amp; any(rem(comp_ic{1,i},1))
0153                 fprintf(fileID,<span class="string">'\n'</span>);
0154                 fprintf(fileID,<span class="string">'     wrong input -&gt; should be integers\n'</span>);
0155                 fprintf(fileID,<span class="string">'\n'</span>);
0156                 <span class="keyword">continue</span>
0157             <span class="keyword">elseif</span> length(comp_ic{1,i})&gt;numberOfTimeSeries-1
0158                 fprintf(fileID,<span class="string">'\n'</span>);
0159                 fprintf(fileID,<span class="string">'     wrong input -&gt; invalid input\n'</span>);
0160                 fprintf(fileID,<span class="string">'\n'</span>);
0161                 <span class="keyword">continue</span>
0162                 
0163             <span class="keyword">elseif</span> any(ismember(comp_ic{1,i}, ForbiddenIndexes{i})) <span class="keyword">...</span>
0164                     || ~isempty(find(comp_ic{1,i}&gt;numberOfTimeSeries,1))
0165                 fprintf(fileID,<span class="string">'\n'</span>);
0166                 fprintf(fileID,[<span class="string">'     wrong input -&gt; conflicts in the '</span> <span class="keyword">...</span>
0167                     <span class="string">'dependency vector.\n'</span>]);
0168                 fprintf(fileID,<span class="string">'\n'</span>);
0169                 <span class="keyword">continue</span>
0170                 
0171             <span class="keyword">else</span>
0172                 <span class="keyword">if</span> comp_ic{1,i} == 0
0173                     comp_ic{1,i}=[];
0174                 <span class="keyword">end</span>
0175                 
0176                 isCorrect=true;
0177             <span class="keyword">end</span>
0178         <span class="keyword">end</span>
0179         misc.internalVars.BatchMode.AnswerIndex = <span class="keyword">...</span>
0180             misc.internalVars.BatchMode.AnswerIndex+1;
0181     <span class="keyword">end</span>
0182 <span class="keyword">else</span>
0183     comp_ic={[]};
0184 <span class="keyword">end</span>
0185 
0186 <span class="comment">%% Get number of model class</span>
0187 fprintf(fileID,<span class="string">'\n'</span>);
0188 incTest=0;
0189 isCorrect = false;
0190 <span class="keyword">while</span> ~isCorrect
0191     
0192     incTest=incTest+1;
0193     <span class="keyword">if</span> incTest &gt; MaxFailAttempts ; error([<span class="string">'Too many failed '</span>, <span class="keyword">...</span>
0194             <span class="string">'attempts ('</span>, num2str(MaxFailAttempts)  <span class="string">').'</span>]) ; <span class="keyword">end</span>
0195     
0196     fprintf(fileID, [<span class="string">'- How many model classes do '</span> <span class="keyword">...</span>
0197         <span class="string">'you want for each time-series? \n'</span>]);
0198     <span class="keyword">if</span> misc.internalVars.BatchMode.isBatchMode
0199         nb_models=eval(char(misc.internalVars.BatchMode.Answers{<span class="keyword">...</span>
0200             misc.internalVars.BatchMode.AnswerIndex}));
0201         fprintf(fileID,<span class="string">'     %s'</span>, num2str(nb_models));
0202     <span class="keyword">else</span>
0203         nb_models=input(<span class="string">'     choice &gt;&gt; '</span>);
0204     <span class="keyword">end</span>
0205     <span class="keyword">if</span> isempty(nb_models)
0206         <span class="keyword">continue</span>
0207     <span class="keyword">elseif</span> length(nb_models) &gt; 1
0208         fprintf(fileID,<span class="string">'\n'</span>);
0209         fprintf(fileID,<span class="string">'     wrong input -&gt; should be a single integer\n'</span>);
0210         fprintf(fileID,<span class="string">'\n'</span>);
0211         <span class="keyword">continue</span>
0212     <span class="keyword">elseif</span> ischar(nb_models)|| rem(nb_models,1)~=0 || sign(nb_models) == -1
0213         fprintf(fileID,<span class="string">'\n'</span>);
0214         fprintf(fileID,<span class="string">'     wrong input -&gt; not a positive integer\n'</span>);
0215         fprintf(fileID,<span class="string">'\n'</span>);
0216         <span class="keyword">continue</span>
0217     <span class="keyword">elseif</span> nb_models &gt; 2
0218         fprintf(fileID,<span class="string">'\n'</span>);
0219         fprintf(fileID,[<span class="string">'     wrong input -&gt; more than 2 model classes '</span> <span class="keyword">...</span>
0220             <span class="string">'is not supported.\n'</span>]);
0221         fprintf(fileID,<span class="string">'\n'</span>);
0222         <span class="keyword">continue</span>
0223     <span class="keyword">else</span>
0224         isCorrect = true;
0225     <span class="keyword">end</span>
0226 <span class="keyword">end</span>
0227 misc.internalVars.BatchMode.AnswerIndex = <span class="keyword">...</span>
0228     misc.internalVars.BatchMode.AnswerIndex+1;
0229 fprintf(fileID,<span class="string">'\n'</span>);
0230 <span class="comment">%% Identify model components for each model class and time series</span>
0231 fprintf(fileID,<span class="string">'\n'</span>);
0232 fprintf(fileID,[<span class="string">'     -------------------------'</span>, <span class="keyword">...</span>
0233     <span class="string">'-------------------------------\n'</span>]);
0234 fprintf(fileID,<span class="string">'     BDLM Component reference numbers\n'</span>);
0235 fprintf(fileID,[<span class="string">'     -------------------'</span>, <span class="keyword">...</span>
0236     <span class="string">'-------------------------------------\n'</span>]);
0237 fprintf(fileID,<span class="string">'     11: Local level \n'</span>);
0238 fprintf(fileID,<span class="string">'     12: Local trend \n'</span>);
0239 fprintf(fileID,<span class="string">'     13: Local acceleration \n'</span>);
0240 fprintf(fileID,<span class="string">'     21: Local level compatible with local trend \n'</span>);
0241 fprintf(fileID,[<span class="string">'     22: Local level compatible '</span>, <span class="keyword">...</span>
0242     <span class="string">'with local acceleration \n'</span>]);
0243 fprintf(fileID,[<span class="string">'     23: Local trend compatible '</span>, <span class="keyword">...</span>
0244     <span class="string">'with local acceleration \n'</span>]);
0245 fprintf(fileID,<span class="string">'     31: Periodic \n'</span>);
0246 fprintf(fileID,<span class="string">'     41: Autoregressive process (AR(1)) \n'</span>);
0247 fprintf(fileID,<span class="string">'     51: Kernel regression \n'</span>);
0248 fprintf(fileID,<span class="string">'     61: Level Intervention \n'</span>);
0249 fprintf(fileID,[<span class="string">'     ---------------------------'</span>, <span class="keyword">...</span>
0250     <span class="string">'-----------------------------\n'</span>]);
0251 fprintf(fileID,<span class="string">'\n'</span>);
0252 
0253 all_components=[11 12 13 21 22 23 31 41 51 61];
0254 level_components=[11 12 13 21 22 23];
0255 
0256 comp=cell(nb_models,numberOfTimeSeries);
0257 
0258 <span class="keyword">for</span> j=1:nb_models
0259     <span class="keyword">if</span> nb_models&gt;1
0260         fprintf(fileID,<span class="string">'\n'</span>);
0261         fprintf(fileID,<span class="string">'- Model class # %s \n'</span>, num2str(j));
0262     <span class="keyword">end</span>
0263     <span class="keyword">for</span> i=1:numberOfTimeSeries
0264         
0265         incTest=0;
0266         isCorrect = false;
0267         <span class="keyword">while</span> ~isCorrect
0268             
0269             incTest=incTest+1;
0270             <span class="keyword">if</span> incTest &gt; MaxFailAttempts ; error([<span class="string">'Too many failed '</span>, <span class="keyword">...</span>
0271                     <span class="string">'attempts ('</span>, num2str(MaxFailAttempts)  <span class="string">').'</span>]) ; <span class="keyword">end</span>
0272             fprintf(fileID,<span class="string">'\n'</span>);
0273             fprintf(fileID,[<span class="string">'- Identify components for '</span> <span class="keyword">...</span>
0274                 <span class="string">'time series #%s; e.g. [11 31 41]\n'</span>], num2str(i));
0275             <span class="keyword">if</span> misc.internalVars.BatchMode.isBatchMode
0276                 comp{j}{i}=eval(char(misc.internalVars.BatchMode.Answers{<span class="keyword">...</span>
0277                     misc.internalVars.BatchMode.AnswerIndex}));
0278                 
0279                 fprintf(fileID, [<span class="string">'     [%s] '</span>, <span class="keyword">...</span>
0280                     <span class="string">'\n'</span>], strjoin(cellstr(num2str(comp{j}{i}(:))),<span class="string">', '</span>));
0281                 
0282             <span class="keyword">else</span>
0283                 comp{j}{i}=input(<span class="string">'     choice &gt;&gt; '</span>);
0284             <span class="keyword">end</span>
0285             <span class="keyword">if</span> isempty(comp{j}{i})
0286                 <span class="keyword">continue</span>
0287             <span class="keyword">elseif</span> ischar(comp{j}{i})
0288                 fprintf(fileID,<span class="string">'\n'</span>);
0289                 fprintf(fileID,<span class="string">'     wrong input -&gt; should be integers\n'</span>);
0290                 fprintf(fileID,<span class="string">'\n'</span>);
0291                 <span class="keyword">continue</span>
0292             <span class="keyword">elseif</span> ~all(ismember(comp{j}{i},all_components))
0293                 fprintf(fileID,<span class="string">'\n'</span>);
0294                 fprintf(fileID,[<span class="string">'     wrong input -&gt; at '</span>, <span class="keyword">...</span>
0295                     <span class="string">'least one component'</span> <span class="keyword">...</span>
0296                     <span class="string">' is unknown \n'</span>]);
0297                 fprintf(fileID,<span class="string">' '</span>);
0298                 <span class="keyword">continue</span>
0299             <span class="keyword">elseif</span> ~all(ismember(comp{j}{i}(1),level_components))
0300                 fprintf(fileID,<span class="string">'\n'</span>);
0301                 fprintf(fileID,[<span class="string">'     wrong input -&gt; first '</span>, <span class="keyword">...</span>
0302                     <span class="string">'component should be a'</span> <span class="keyword">...</span>
0303                     <span class="string">' level component (i.e. either 11 12 13 21 22 23)\n'</span>]);
0304                 fprintf(fileID,<span class="string">'\n'</span>);
0305                 <span class="keyword">continue</span>
0306             <span class="keyword">elseif</span> length(comp{j}{i}) &gt; 1 &amp;&amp; <span class="keyword">...</span>
0307                     any(ismember(comp{j}{i}(2:end),level_components))
0308                 fprintf(fileID,<span class="string">'\n'</span>);
0309                 fprintf(fileID,[<span class="string">'     wrong input -&gt; '</span>, <span class="keyword">...</span>
0310                     <span class="string">'only the first component'</span> <span class="keyword">...</span>
0311                     <span class="string">' should be a level component\n'</span>]);
0312                 fprintf(fileID,<span class="string">'\n'</span>);
0313                 <span class="keyword">continue</span>
0314             <span class="keyword">elseif</span> j == 1 &amp;&amp; nb_models&gt;1 &amp;&amp; <span class="keyword">...</span>
0315                     any(ismember(comp{j}{i}(1),level_components(1:3)))
0316                 fprintf(fileID,<span class="string">'\n'</span>);
0317                 fprintf(fileID,[<span class="string">'     wrong input -&gt; the '</span>, <span class="keyword">...</span>
0318                     <span class="string">'first component for'</span> <span class="keyword">...</span>
0319                     <span class="string">' model class 1 should be a level compatible'</span> <span class="keyword">...</span>
0320                     <span class="string">' component (i.e. either 21 22 23 )\n'</span>]);
0321                 fprintf(fileID,<span class="string">'\n'</span>);
0322                 <span class="keyword">continue</span>
0323             <span class="keyword">elseif</span> j == 1 &amp;&amp; nb_models == 1 &amp;&amp; <span class="keyword">...</span>
0324                     any(ismember(comp{j}{i}(1),level_components(4:6)))
0325                 fprintf(fileID,<span class="string">'\n'</span>);
0326                 fprintf(fileID,[<span class="string">'     wrong input -&gt; the '</span>, <span class="keyword">...</span>
0327                     <span class="string">'first component for '</span> <span class="keyword">...</span>
0328                     <span class="string">'model class 1 should not be a level compatible '</span> <span class="keyword">...</span>
0329                     <span class="string">'component (i.e. only 11 12 13 are supported).\n'</span>]);
0330                 fprintf(fileID,<span class="string">'\n'</span>);
0331                 <span class="keyword">continue</span>
0332             <span class="keyword">elseif</span> j == 2 &amp;&amp; nb_models&gt;1 &amp;&amp; comp{1}{i}(1) == 21 &amp;&amp; <span class="keyword">...</span>
0333                     comp{j}{i}(1) ~= 12 &amp;&amp; comp{j}{i}(1) ~= 21
0334                 fprintf(fileID,<span class="string">'\n'</span>);
0335                 fprintf(fileID,[<span class="string">'     wrong input -&gt; the '</span>, <span class="keyword">...</span>
0336                     <span class="string">'level component'</span> <span class="keyword">...</span>
0337                     <span class="string">' for the two model classes are not compatibles'</span>]);
0338                 fprintf(fileID,<span class="string">'\n'</span>);
0339                 <span class="keyword">continue</span>
0340             <span class="keyword">elseif</span> j == 2 &amp;&amp; nb_models&gt;1 &amp;&amp; comp{1}{i}(1) == 22 &amp;&amp; <span class="keyword">...</span>
0341                     comp{j}{i}(1) ~= 13 &amp;&amp; comp{j}{i}(1) ~= 22
0342                 fprintf(fileID,<span class="string">'\n'</span>);
0343                 fprintf(fileID,[<span class="string">'     wrong input -&gt; the level'</span> <span class="keyword">...</span>
0344                     <span class="string">' component for the two model classes are not'</span> <span class="keyword">...</span>
0345                     <span class="string">' compatibles\n'</span>]);
0346                 fprintf(fileID,<span class="string">'\n'</span>);
0347                 <span class="keyword">continue</span>
0348             <span class="keyword">elseif</span> j == 2 &amp;&amp; nb_models&gt;1 &amp;&amp; comp{1}{i}(1) == 23 &amp;&amp; <span class="keyword">...</span>
0349                     comp{j}{i}(1) ~= 13 &amp;&amp; comp{j}{i}(1) ~= 23
0350                 fprintf(fileID,<span class="string">'\n'</span>);
0351                 fprintf(fileID,[<span class="string">'     wrong input -&gt; the '</span>, <span class="keyword">...</span>
0352                     <span class="string">'level component '</span> <span class="keyword">...</span>
0353                     <span class="string">'for the two model classes are not compatibles\n'</span>]);
0354                 fprintf(fileID,<span class="string">'\n'</span>);
0355                 <span class="keyword">continue</span>
0356             <span class="keyword">elseif</span> j&gt;1&amp;&amp; length(comp{j}{i})~=length(comp{j-1}{i})
0357                 fprintf(fileID,<span class="string">'\n'</span>);
0358                 fprintf(fileID,[<span class="string">'     wrong input -&gt; all model'</span> <span class="keyword">...</span>
0359                     <span class="string">' classes must have the same number of components\n'</span>]);
0360                 fprintf(fileID,<span class="string">'\n'</span>);
0361                 <span class="keyword">continue</span>
0362             <span class="keyword">else</span>
0363                 isCorrect=true;
0364                 misc.internalVars.BatchMode.AnswerIndex = <span class="keyword">...</span>
0365                     misc.internalVars.BatchMode.AnswerIndex+1;
0366             <span class="keyword">end</span>
0367         <span class="keyword">end</span>
0368     <span class="keyword">end</span>
0369 <span class="keyword">end</span>
0370 
0371 <span class="comment">%% Identify constrained components</span>
0372 const=cell(nb_models,numberOfTimeSeries);
0373 <span class="keyword">if</span> nb_models&gt;1
0374     <span class="keyword">for</span> j=2:nb_models
0375         <span class="comment">%fprintf(fileID,'- Model class # %s\n', num2str(j));</span>
0376         <span class="keyword">for</span> i=1:numberOfTimeSeries
0377             
0378             incTest=0;
0379             isCorrect = false;
0380             <span class="keyword">while</span> ~isCorrect
0381                 incTest=incTest+1;
0382                 <span class="keyword">if</span> incTest &gt; MaxFailAttempts
0383                     error([<span class="string">'Too many failed '</span>, <span class="keyword">...</span>
0384                         <span class="string">'attempts ('</span>, num2str(MaxFailAttempts)  <span class="string">').'</span>])
0385                 <span class="keyword">end</span>
0386                 fprintf(fileID,<span class="string">'\n'</span>);
0387                 fprintf(fileID,[<span class="string">'- Identify the shared parameters'</span> <span class="keyword">...</span>
0388                     <span class="string">' between the components of the model'</span> <span class="keyword">...</span>
0389                     <span class="string">' classes 1 and 2 for time '</span>, <span class="keyword">...</span>
0390                     <span class="string">' series #%s ; e.g. [0 1 1]\n'</span>], <span class="keyword">...</span>
0391                     num2str(i));
0392                 <span class="keyword">if</span> misc.internalVars.BatchMode.isBatchMode
0393                     const{j}{i}=eval(char(misc.internalVars.BatchMode.Answers{ <span class="keyword">...</span>
0394                         misc.internalVars.BatchMode.AnswerIndex}));
0395                     
0396                     fprintf(fileID, [<span class="string">'     [%s] '</span>, <span class="keyword">...</span>
0397                         <span class="string">'\n'</span>], strjoin(cellstr(num2str(const{j}{i}(:))),<span class="string">', '</span>));
0398                     
0399                 <span class="keyword">else</span>
0400                     const{j}{i}=input(<span class="string">'     choice &gt;&gt;'</span>);
0401                 <span class="keyword">end</span>
0402                 <span class="keyword">if</span> isempty(const{j}{i})
0403                     <span class="keyword">continue</span>
0404                 <span class="keyword">elseif</span> length(const{j}{i})~=length(comp{j}{i})
0405                     fprintf(fileID,<span class="string">'\n'</span>);
0406                     fprintf(fileID,[<span class="string">'     wrong input -&gt; the number of '</span> <span class="keyword">...</span>
0407                         <span class="string">'constraint parameters must be the same '</span> <span class="keyword">...</span>
0408                         <span class="string">'as the number of components\n'</span>]);
0409                     fprintf(fileID,<span class="string">'\n'</span>);
0410                     <span class="keyword">continue</span>
0411                 <span class="keyword">elseif</span> ischar(const{j}{i})
0412                     fprintf(fileID,<span class="string">'\n'</span>);
0413                     fprintf(fileID,[<span class="string">'     wrong input -&gt; '</span>, <span class="keyword">...</span>
0414                         <span class="string">'should be integers\n'</span>]);
0415                     fprintf(fileID,<span class="string">'\n'</span>);
0416                     <span class="keyword">continue</span>
0417                 <span class="keyword">elseif</span> ~all(ismember(const{j}{i}, [0,1]))
0418                     fprintf(fileID,<span class="string">'\n'</span>);
0419                     fprintf(fileID,[<span class="string">'     wrong input -&gt; '</span>, <span class="keyword">...</span>
0420                         <span class="string">'should be 0 or 1\n'</span>]);
0421                     fprintf(fileID,<span class="string">'\n'</span>);
0422                     <span class="keyword">continue</span>
0423                 <span class="keyword">else</span>
0424                     isCorrect = true;
0425                     misc.internalVars.BatchMode.AnswerIndex = <span class="keyword">...</span>
0426                         misc.internalVars.BatchMode.AnswerIndex+1;
0427                 <span class="keyword">end</span>
0428             <span class="keyword">end</span>
0429         <span class="keyword">end</span>
0430     <span class="keyword">end</span>
0431 <span class="keyword">end</span>
0432 fprintf(fileID,<span class="string">'\n'</span>);
0433 
0434 
0435 model.nb_class = nb_models;
0436 
0437 <span class="comment">% Model blocks</span>
0438 <span class="keyword">for</span> j=1:nb_models
0439     str_3 = <span class="string">' '</span>; <span class="comment">%strings;</span>
0440     <span class="keyword">for</span> i=1:numberOfTimeSeries
0441         str_1 = sprintf(<span class="string">'%d '</span>, comp{j}{i});
0442         str_2 = strjoin([{<span class="string">'['</span>} str_1 {<span class="string">']'</span>}]);
0443         str_3 = [str_3 <span class="string">' '</span> str_2];
0444     <span class="keyword">end</span>
0445     str_4 = sprintf(<span class="string">'model.components.block{%d}={%s};'</span>, j, str_3 );
0446     eval(str_4)
0447 <span class="keyword">end</span>
0448 
0449 
0450 <span class="comment">% Model constrains</span>
0451 <span class="keyword">for</span> j=2:nb_models
0452     str_3 = <span class="string">''</span>; <span class="comment">%strings;</span>
0453     <span class="keyword">for</span> i=1:numberOfTimeSeries
0454         str_1 = sprintf(<span class="string">'%d '</span>, const{j}{i});
0455         str_2 = strjoin([{<span class="string">'['</span>} str_1 {<span class="string">']'</span>}]);
0456         str_3 = [str_3 <span class="string">' '</span> str_2];
0457     <span class="keyword">end</span>
0458     str_4 = sprintf(<span class="string">'model.components.const{%d}={%s};'</span>, j, str_3 );
0459     eval(str_4)
0460 <span class="keyword">end</span>
0461 
0462 <span class="comment">% Observations interdependencies</span>
0463 str_3 = <span class="string">''</span>; <span class="comment">%strings;</span>
0464 <span class="keyword">for</span> j=1:numberOfTimeSeries
0465     str_1 = sprintf(<span class="string">'%d '</span>, comp_ic{1,j});
0466     str_2 = strjoin([{<span class="string">'['</span>} str_1 {<span class="string">']'</span>}]);
0467     str_3 = [str_3 <span class="string">' '</span> str_2];
0468 <span class="keyword">end</span>
0469 str_4=sprintf(<span class="string">'model.components.ic={%s};'</span>, str_3);
0470 eval(str_4)
0471 
0472 <span class="comment">%--------------------END CODE ------------------------</span>
0473 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Tue 05-Feb-2019 11:23:52 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>