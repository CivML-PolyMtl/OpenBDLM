<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of selectTimePeriod</title>
  <meta name="keywords" content="selectTimePeriod">
  <meta name="description" content="SELECTTIMEPERIOD Select data between two dates">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="../../index.html">OpenBDLM_V1.0</a> &gt; <a href="#">functions</a> &gt; <a href="index.html">Others</a> &gt; selectTimePeriod.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for OpenBDLM_V1.0/functions/Others&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>selectTimePeriod
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>SELECTTIMEPERIOD Select data between two dates</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function [data, misc]=selectTimePeriod(data, misc) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">SELECTTIMEPERIOD Select data between two dates

   SYNOPSIS:
     [data, misc]=SELECTTIMEPERIOD(data, misc)

   INPUT:
       data            - structure (required)
                       
                           data must contain three fields:

                               'timestamps' is a M×1 array

                               'values' is a MxN  array

                               'labels' is a 1×N cell array
                               each cell is a character array

                               N: number of time series
                               M: number of samples

      misc             - structure
                          see the documentation for details about the
                          field in misc

   OUTPUT:
       data            - structure (required)
                       
                           data must contain three fields:

                               'timestamps' is a M×1 array

                               'values' is a MxN  array

                               'labels' is a 1×N cell array
                               each cell is a character array

                               N: number of time series
                               M: number of samples

      misc             - structure
                          see the documentation for details about the
                          field in misc

   DESCRIPTION:
      SELECTTIMEPERIOD select data between two dates.
      SELECTTIMEPERIOD request user's input to get the two dates.

      If end date &gt; last date of the dataset, add trailing missing data at
      the end of the dataset. In this case, the timestep for the missing
      data is provided by user's input.
      Padding with missing data is useful for prediction.

   EXAMPLES:
      [data, misc]=SELECTTIMEPERIOD(data, misc)

   EXTERNAL FUNCTIONS CALLED:
      convertMat2Cell, convertCell2Mat

   SUBFUNCTIONS:
      N/A

   See also EDITDATA, <a href="convertMat2Cell.html" class="code" title="function [data]=convertMat2Cell(data)">CONVERTMAT2CELL</a>, <a href="convertCell2Mat.html" class="code" title="function [data]=convertCell2Mat(data)">CONVERTCELL2MAT</a></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../OpenBDLM_V1.0/functions/DataLoader/editData.html" class="code" title="function [data, misc, dataFilename]=editData(data, misc, varargin)">editData</a>	EDITDATA Control script to edit dataset (selection, resampling, etc..)</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [data, misc]=selectTimePeriod(data, misc)</a>
0002 <span class="comment">%SELECTTIMEPERIOD Select data between two dates</span>
0003 <span class="comment">%</span>
0004 <span class="comment">%   SYNOPSIS:</span>
0005 <span class="comment">%     [data, misc]=SELECTTIMEPERIOD(data, misc)</span>
0006 <span class="comment">%</span>
0007 <span class="comment">%   INPUT:</span>
0008 <span class="comment">%       data            - structure (required)</span>
0009 <span class="comment">%</span>
0010 <span class="comment">%                           data must contain three fields:</span>
0011 <span class="comment">%</span>
0012 <span class="comment">%                               'timestamps' is a M×1 array</span>
0013 <span class="comment">%</span>
0014 <span class="comment">%                               'values' is a MxN  array</span>
0015 <span class="comment">%</span>
0016 <span class="comment">%                               'labels' is a 1×N cell array</span>
0017 <span class="comment">%                               each cell is a character array</span>
0018 <span class="comment">%</span>
0019 <span class="comment">%                               N: number of time series</span>
0020 <span class="comment">%                               M: number of samples</span>
0021 <span class="comment">%</span>
0022 <span class="comment">%      misc             - structure</span>
0023 <span class="comment">%                          see the documentation for details about the</span>
0024 <span class="comment">%                          field in misc</span>
0025 <span class="comment">%</span>
0026 <span class="comment">%   OUTPUT:</span>
0027 <span class="comment">%       data            - structure (required)</span>
0028 <span class="comment">%</span>
0029 <span class="comment">%                           data must contain three fields:</span>
0030 <span class="comment">%</span>
0031 <span class="comment">%                               'timestamps' is a M×1 array</span>
0032 <span class="comment">%</span>
0033 <span class="comment">%                               'values' is a MxN  array</span>
0034 <span class="comment">%</span>
0035 <span class="comment">%                               'labels' is a 1×N cell array</span>
0036 <span class="comment">%                               each cell is a character array</span>
0037 <span class="comment">%</span>
0038 <span class="comment">%                               N: number of time series</span>
0039 <span class="comment">%                               M: number of samples</span>
0040 <span class="comment">%</span>
0041 <span class="comment">%      misc             - structure</span>
0042 <span class="comment">%                          see the documentation for details about the</span>
0043 <span class="comment">%                          field in misc</span>
0044 <span class="comment">%</span>
0045 <span class="comment">%   DESCRIPTION:</span>
0046 <span class="comment">%      SELECTTIMEPERIOD select data between two dates.</span>
0047 <span class="comment">%      SELECTTIMEPERIOD request user's input to get the two dates.</span>
0048 <span class="comment">%</span>
0049 <span class="comment">%      If end date &gt; last date of the dataset, add trailing missing data at</span>
0050 <span class="comment">%      the end of the dataset. In this case, the timestep for the missing</span>
0051 <span class="comment">%      data is provided by user's input.</span>
0052 <span class="comment">%      Padding with missing data is useful for prediction.</span>
0053 <span class="comment">%</span>
0054 <span class="comment">%   EXAMPLES:</span>
0055 <span class="comment">%      [data, misc]=SELECTTIMEPERIOD(data, misc)</span>
0056 <span class="comment">%</span>
0057 <span class="comment">%   EXTERNAL FUNCTIONS CALLED:</span>
0058 <span class="comment">%      convertMat2Cell, convertCell2Mat</span>
0059 <span class="comment">%</span>
0060 <span class="comment">%   SUBFUNCTIONS:</span>
0061 <span class="comment">%      N/A</span>
0062 <span class="comment">%</span>
0063 <span class="comment">%   See also EDITDATA, CONVERTMAT2CELL, CONVERTCELL2MAT</span>
0064 
0065 <span class="comment">%   AUTHORS:</span>
0066 <span class="comment">%       Ianis Gaudot, Luong Ha Nguyen, James-A Goulet</span>
0067 <span class="comment">%</span>
0068 <span class="comment">%      Email: &lt;james.goulet@polymtl.ca&gt;</span>
0069 <span class="comment">%      Website: &lt;http://www.polymtl.ca/expertises/goulet-james-alexandre&gt;</span>
0070 <span class="comment">%</span>
0071 <span class="comment">%   MATLAB VERSION:</span>
0072 <span class="comment">%      Tested on 9.1.0.441655 (R2016b)</span>
0073 <span class="comment">%</span>
0074 <span class="comment">%   DATE CREATED:</span>
0075 <span class="comment">%       July 4, 2018</span>
0076 <span class="comment">%</span>
0077 <span class="comment">%   DATE LAST UPDATE:</span>
0078 <span class="comment">%       October 16, 2018</span>
0079 
0080 <span class="comment">%--------------------BEGIN CODE ----------------------</span>
0081 <span class="comment">%% Get arguments passed to the function and proceed to some verifications</span>
0082 p = inputParser;
0083 
0084 addRequired(p,<span class="string">'data'</span>, @isstruct );
0085 addRequired(p,<span class="string">'misc'</span>, @isstruct );
0086 parse(p,data, misc);
0087 
0088 data=p.Results.data;
0089 misc=p.Results.misc;
0090 
0091 MaxFailAttempts=4;
0092 
0093 <span class="comment">% Set fileID for logfile</span>
0094 <span class="keyword">if</span> misc.internalVars.isQuiet
0095     <span class="comment">% output message in logfile</span>
0096     fileID=fopen(misc.internalVars.logFileName, <span class="string">'a'</span>);
0097 <span class="keyword">else</span>
0098     <span class="comment">% output message on screen and logfile using diary command</span>
0099     fileID=1;
0100 <span class="keyword">end</span>
0101 
0102 <span class="comment">%% Get number of time series</span>
0103 numberOfTimeSeries =size(data.values, 2);
0104 
0105 <span class="comment">%% Get timestamps</span>
0106 timestamps=data.timestamps;
0107 
0108 fprintf(fileID, <span class="string">'- Define timestamps\n'</span>);
0109 fmt = <span class="string">'yyyy-mm-dd'</span>;
0110 
0111 <span class="comment">%% Request user's input to specify start date</span>
0112 incTest=0;
0113 isCorrect = false;
0114 <span class="keyword">while</span> ~isCorrect
0115     incTest=incTest+1;
0116     <span class="keyword">if</span> incTest &gt; MaxFailAttempts ; error([<span class="string">'Too many failed '</span>, <span class="keyword">...</span>
0117             <span class="string">'attempts ('</span>, num2str(MaxFailAttempts)  <span class="string">').'</span>]) ; <span class="keyword">end</span>
0118     
0119     fprintf(fileID,<span class="string">'     Start date (%s): \n'</span>,fmt);
0120     <span class="keyword">if</span> misc.internalVars.BatchMode.isBatchMode
0121         tts=eval(char(misc.internalVars.BatchMode.Answers{<span class="keyword">...</span>
0122             misc.internalVars.BatchMode.AnswerIndex}));
0123         fprintf(fileID, <span class="string">'     %s\n'</span>, tts);
0124     <span class="keyword">else</span>
0125         tts = input(<span class="string">'     choice &gt;&gt; '</span>,<span class="string">'s'</span>);
0126     <span class="keyword">end</span>
0127     
0128     <span class="comment">% Remove space and quotes</span>
0129     tts=strrep(tts,<span class="string">''''</span>,<span class="string">''</span> ); <span class="comment">% remove quotes</span>
0130     tts=strrep(tts,<span class="string">'&quot;'</span>,<span class="string">''</span> ); <span class="comment">% remove double quotes</span>
0131     tts=strrep(tts, <span class="string">' '</span>,<span class="string">''</span> ); <span class="comment">% remove spaces</span>
0132     
0133     <span class="keyword">if</span> isempty(tts)
0134         <span class="keyword">continue</span>
0135     <span class="keyword">else</span>
0136         <span class="keyword">try</span>
0137             datenum(tts,fmt);
0138         <span class="keyword">catch</span>
0139             fprintf(fileID, <span class="string">'\n'</span>);
0140             fprintf(fileID, <span class="string">'     wrong format. Format should be %s\n'</span>,fmt );
0141             fprintf(fileID, <span class="string">'\n'</span>);
0142             <span class="keyword">continue</span>
0143         <span class="keyword">end</span>
0144         
0145         <span class="keyword">if</span> ~strcmp(datestr(tts, fmt), tts )
0146             fprintf(fileID, <span class="string">'\n'</span>);
0147             fprintf(fileID, <span class="string">'     wrong input: Invalid date.\n'</span>);
0148             fprintf(fileID, <span class="string">'\n'</span>);
0149             <span class="keyword">continue</span>
0150         <span class="keyword">end</span>
0151         
0152     <span class="keyword">end</span>
0153     isCorrect = true;
0154 <span class="keyword">end</span>
0155 <span class="comment">% Increment global variable to read next answer when required</span>
0156 misc.internalVars.BatchMode.AnswerIndex = <span class="keyword">...</span>
0157     misc.internalVars.BatchMode.AnswerIndex + 1;
0158 fprintf(fileID, <span class="string">'\n'</span>);
0159 
0160 <span class="comment">%% Request user's input to specify end date</span>
0161 incTest=0;
0162 isCorrect = false;
0163 <span class="keyword">while</span> ~isCorrect
0164     
0165     incTest=incTest+1;
0166     <span class="keyword">if</span> incTest &gt; MaxFailAttempts ; error([<span class="string">'Too many failed '</span>, <span class="keyword">...</span>
0167             <span class="string">'attempts ('</span>, num2str(MaxFailAttempts)  <span class="string">').'</span>]) ; <span class="keyword">end</span>
0168     
0169     fprintf(fileID, <span class="string">'     End date (%s): \n'</span>,fmt);
0170     <span class="keyword">if</span> misc.internalVars.BatchMode.isBatchMode
0171         tte=eval(char(misc.internalVars.BatchMode.Answers{<span class="keyword">...</span>
0172             misc.internalVars.BatchMode.AnswerIndex}));
0173         fprintf(fileID, <span class="string">'     %s\n'</span>, tte);
0174     <span class="keyword">else</span>
0175         tte = input(<span class="string">'     choice &gt;&gt; '</span>,<span class="string">'s'</span>);
0176     <span class="keyword">end</span>
0177     
0178     <span class="comment">% Remove space and quotes</span>
0179     tte=strrep(tte,<span class="string">''''</span>,<span class="string">''</span> ); <span class="comment">% remove quotes</span>
0180     tte=strrep(tte,<span class="string">'&quot;'</span>,<span class="string">''</span> ); <span class="comment">% remove double quotes</span>
0181     tte=strrep(tte, <span class="string">' '</span>,<span class="string">''</span> ); <span class="comment">% remove spaces</span>
0182     
0183     <span class="keyword">if</span> isempty(tte)
0184         <span class="keyword">continue</span>
0185     <span class="keyword">else</span>
0186         <span class="keyword">try</span>
0187             datenum(tte,fmt);
0188         <span class="keyword">catch</span>
0189             fprintf(fileID, <span class="string">'\n'</span>);
0190             fprintf(fileID, <span class="string">'     wrong format. Format should be %s\n'</span>,fmt );
0191             fprintf(fileID, <span class="string">'\n'</span>);
0192             <span class="keyword">continue</span>
0193         <span class="keyword">end</span>
0194         
0195         <span class="keyword">if</span> ~strcmp(datestr(tte, fmt), tte )
0196             fprintf(fileID, <span class="string">'\n'</span>);
0197             fprintf(fileID, <span class="string">'    wrong input: Invalid date.\n'</span>);
0198             fprintf(fileID, <span class="string">'\n'</span>);
0199             <span class="keyword">continue</span>
0200         <span class="keyword">end</span>
0201         
0202         <span class="keyword">if</span> datenum(tte) &lt;= datenum(tts)
0203             fprintf(fileID, <span class="string">'\n'</span>);
0204             fprintf(fileID, [<span class="string">'     wrong input: end date  '</span> <span class="keyword">...</span>
0205                 <span class="string">'should be more recent than start date\n'</span>]);
0206             fprintf(fileID, <span class="string">'\n'</span>);
0207             <span class="keyword">continue</span>
0208         <span class="keyword">end</span>
0209         
0210         <span class="keyword">if</span> datenum(tte) &lt;= datenum(timestamps(1))
0211             fprintf(fileID, <span class="string">'\n'</span>);
0212             fprintf(fileID, [<span class="string">'     wrong input: end date  '</span> <span class="keyword">...</span>
0213                 <span class="string">'should be more recent that the '</span>, <span class="keyword">...</span>
0214                 <span class="string">'date of first data sample\n'</span>]);
0215             fprintf(fileID, <span class="string">'\n'</span>);
0216             <span class="keyword">continue</span>
0217         <span class="keyword">end</span>
0218         
0219         
0220     <span class="keyword">end</span>
0221     isCorrect = true;
0222 <span class="keyword">end</span>
0223 <span class="comment">% Increment global variable to read next answer when required</span>
0224 misc.internalVars.BatchMode.AnswerIndex = <span class="keyword">...</span>
0225     misc.internalVars.BatchMode.AnswerIndex + 1;
0226 
0227 <span class="keyword">if</span> datenum(tte, fmt) &gt; timestamps(end)
0228     
0229     isPadding = true;
0230     incTest=0;
0231     isAnswerCorrect = false;
0232     <span class="keyword">while</span> ~isAnswerCorrect
0233         
0234         incTest=incTest+1;
0235         <span class="keyword">if</span> incTest &gt; MaxFailAttempts ; error([<span class="string">'Too many failed '</span>, <span class="keyword">...</span>
0236                 <span class="string">'attempts ('</span>, num2str(MaxFailAttempts)  <span class="string">').'</span>]) ; <span class="keyword">end</span>
0237         
0238         fprintf(fileID, <span class="string">'\n'</span>);
0239         fprintf(fileID, <span class="string">'     The end date &gt; last date.\n'</span>);
0240         fprintf(fileID, <span class="string">'     Padding with NaN will be done.'</span>);
0241         fprintf(fileID, [<span class="string">'     Give a time step (in day) '</span>, <span class="keyword">...</span>
0242             <span class="string">'to perform the data padding.\n'</span>]);
0243         <span class="keyword">if</span> misc.internalVars.BatchMode.isBatchMode
0244             dt_ref= <span class="keyword">...</span>
0245                 eval(char(misc.internalVars.BatchMode.Answers{<span class="keyword">...</span>
0246                 misc.internalVars.BatchMode.AnswerIndex}));
0247             fprintf(fileID, <span class="string">'     %s\n'</span>,num2str(dt_ref));
0248         <span class="keyword">else</span>
0249             dt_ref = input(<span class="string">'     choice &gt;&gt; '</span>);
0250         <span class="keyword">end</span>
0251         
0252         <span class="keyword">if</span>  isnumeric(dt_ref) &amp;&amp; length(dt_ref) == 1
0253             isAnswerCorrect = true;
0254         <span class="keyword">else</span>
0255             fprintf(fileID, <span class="string">'     wrong input\n'</span>);
0256             <span class="keyword">continue</span>
0257         <span class="keyword">end</span>
0258         
0259     <span class="keyword">end</span>
0260     
0261     <span class="comment">% Increment global variable to read next answer when required</span>
0262     misc.internalVars.BatchMode.AnswerIndex = <span class="keyword">...</span>
0263         misc.internalVars.BatchMode.AnswerIndex + 1;
0264     
0265 <span class="keyword">else</span>
0266     isPadding = false;
0267     
0268 <span class="keyword">end</span>
0269 
0270 <span class="comment">%% Select requested time period</span>
0271 
0272 <span class="comment">% Get sample index the closest to user's requested start date</span>
0273 [~, IdxStart] = min(abs(timestamps-datenum(tts, fmt)));
0274 
0275 <span class="comment">% Get sample index the closest to user's requested end date</span>
0276 [~, IdxEnd] = min(abs(timestamps-datenum(tte, fmt)));
0277 
0278 <span class="comment">% Extract corresponding portion of data</span>
0279 
0280 <span class="keyword">if</span> ~isPadding
0281     data.timestamps = data.timestamps(IdxStart:IdxEnd,:);
0282     data.values = data.values(IdxStart:IdxEnd,:);
0283 <span class="keyword">else</span>
0284     extra_ts = timestamps(end)+dt_ref:dt_ref:datenum(tte, fmt);
0285     
0286         data.timestamps = [ repmat(data.timestamps(IdxStart:IdxEnd,1), <span class="keyword">...</span>
0287         1,1); repmat( extra_ts', 1, 1)];
0288     
0289     data.values = [ data.values(IdxStart:IdxEnd,:) ; <span class="keyword">...</span>
0290         NaN(length(extra_ts),numberOfTimeSeries ) ];
0291 <span class="keyword">end</span>
0292 
0293 <span class="comment">%--------------------END CODE ------------------------</span>
0294 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Tue 05-Feb-2019 11:23:52 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>