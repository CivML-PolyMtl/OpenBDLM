<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of defineModel</title>
  <meta name="keywords" content="defineModel">
  <meta name="description" content="DEFINEMODEL requests user to define model">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="../../index.html">BDLM_DATA_LOADER_9</a> &gt; <a href="#">functions</a> &gt; <a href="index.html">ModelConfiguration</a> &gt; defineModel.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for BDLM_DATA_LOADER_9/functions/ModelConfiguration&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>defineModel
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>DEFINEMODEL requests user to define model</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function [model]=defineModel(data, misc) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">DEFINEMODEL requests user to define model

   SYNOPSIS:
     [model, misc]=DEFINEMODEL(data, misc)

   INPUT:
      data                - structure (required)
                            data contains three fields :

                              'timestamps' is a 1×N cell array
                              each cell is a M_ix1 real array

                              'values' is a 1×N cell array
                              each cell is a M_ix1 real array

                              'labels' is a 1×N cell array
                              each cell is a character array

                    N: number of time series
                    M_i: number of samples of time series i

      misc                - structure (required)
                            see documentation for details about the fields
                            in structure &quot;misc&quot;

   OUTPUT:
      model               - structure
                            see documentation for details about the fields
                            in structure &quot;model&quot;


   DESCRIPTION:
      DEFINEMODEL requests user to define model

   EXAMPLES:
      [model, misc]=DEFINEMODEL(data, misc)

   EXTERNAL FUNCTIONS CALLED:
      N/A

   See also</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../BDLM_DATA_LOADER_9/functions/DataLoader/displayData.html" class="code" title="function displayData(data)">displayData</a>	DISPLAYDATA Display on screen the content of the data in memory</li><li><a href="../../../BDLM_DATA_LOADER_9/functions/DataLoader/verificationDataStructure.html" class="code" title="function [isValid]=verificationDataStructure(data)">verificationDataStructure</a>	VERIFICATIONDATASTRUCTURE Verify formatting of data structure</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="configureModelForDataReal.html" class="code" title="function [data, model, estimation, misc]=configureModelForDataReal(data, model, estimation , misc)">configureModelForDataReal</a>	CONFIGUREMODELFORDATAREAL configures model for BDLM analysis based on real data</li><li><a href="configureModelForDataSimulation.html" class="code" title="function [data, model, estimation, misc]=configureModelForDataSimulation(data, model, estimation , misc)">configureModelForDataSimulation</a>	CONFIGUREMODELFORDATASIMULATION configures model for BDLM analysis based on simulated data</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [model]=defineModel(data, misc)</a>
0002 <span class="comment">%DEFINEMODEL requests user to define model</span>
0003 <span class="comment">%</span>
0004 <span class="comment">%   SYNOPSIS:</span>
0005 <span class="comment">%     [model, misc]=DEFINEMODEL(data, misc)</span>
0006 <span class="comment">%</span>
0007 <span class="comment">%   INPUT:</span>
0008 <span class="comment">%      data                - structure (required)</span>
0009 <span class="comment">%                            data contains three fields :</span>
0010 <span class="comment">%</span>
0011 <span class="comment">%                              'timestamps' is a 1×N cell array</span>
0012 <span class="comment">%                              each cell is a M_ix1 real array</span>
0013 <span class="comment">%</span>
0014 <span class="comment">%                              'values' is a 1×N cell array</span>
0015 <span class="comment">%                              each cell is a M_ix1 real array</span>
0016 <span class="comment">%</span>
0017 <span class="comment">%                              'labels' is a 1×N cell array</span>
0018 <span class="comment">%                              each cell is a character array</span>
0019 <span class="comment">%</span>
0020 <span class="comment">%                    N: number of time series</span>
0021 <span class="comment">%                    M_i: number of samples of time series i</span>
0022 <span class="comment">%</span>
0023 <span class="comment">%      misc                - structure (required)</span>
0024 <span class="comment">%                            see documentation for details about the fields</span>
0025 <span class="comment">%                            in structure &quot;misc&quot;</span>
0026 <span class="comment">%</span>
0027 <span class="comment">%   OUTPUT:</span>
0028 <span class="comment">%      model               - structure</span>
0029 <span class="comment">%                            see documentation for details about the fields</span>
0030 <span class="comment">%                            in structure &quot;model&quot;</span>
0031 <span class="comment">%</span>
0032 <span class="comment">%</span>
0033 <span class="comment">%   DESCRIPTION:</span>
0034 <span class="comment">%      DEFINEMODEL requests user to define model</span>
0035 <span class="comment">%</span>
0036 <span class="comment">%   EXAMPLES:</span>
0037 <span class="comment">%      [model, misc]=DEFINEMODEL(data, misc)</span>
0038 <span class="comment">%</span>
0039 <span class="comment">%   EXTERNAL FUNCTIONS CALLED:</span>
0040 <span class="comment">%      N/A</span>
0041 <span class="comment">%</span>
0042 <span class="comment">%   See also</span>
0043 
0044 <span class="comment">%   AUTHORS:</span>
0045 <span class="comment">%      Ianis Gaudot, Luong Ha Nguyen, James-A Goulet</span>
0046 <span class="comment">%</span>
0047 <span class="comment">%      Email: &lt;james.goulet@polymtl.ca&gt;</span>
0048 <span class="comment">%      Website: &lt;http://www.polymtl.ca/expertises/goulet-james-alexandre&gt;</span>
0049 <span class="comment">%</span>
0050 <span class="comment">%   MATLAB VERSION:</span>
0051 <span class="comment">%      Tested on 9.1.0.441655 (R2016b)</span>
0052 <span class="comment">%</span>
0053 <span class="comment">%   DATE CREATED:</span>
0054 <span class="comment">%       April 20, 2018</span>
0055 <span class="comment">%</span>
0056 <span class="comment">%   DATE LAST UPDATE:</span>
0057 <span class="comment">%       April 20, 2018</span>
0058 
0059 <span class="comment">%--------------------BEGIN CODE ----------------------</span>
0060 <span class="comment">%% Get arguments passed to the function and proceed to some verifications</span>
0061 p = inputParser;
0062 
0063 addRequired(p,<span class="string">'data'</span>, @isstruct );
0064 addRequired(p,<span class="string">'misc'</span>, @isstruct );
0065 parse(p,data, misc);
0066 
0067 data=p.Results.data;
0068 misc=p.Results.misc;
0069 
0070 <span class="keyword">if</span> ~misc.isDataSimulation
0071     <span class="comment">% Validation of structure data</span>
0072     isValid = <a href="../../../BDLM_DATA_LOADER_9/functions/DataLoader/verificationDataStructure.html" class="code" title="function [isValid]=verificationDataStructure(data)">verificationDataStructure</a>(data);
0073     <span class="keyword">if</span> ~isValid
0074         disp(<span class="string">' '</span>)
0075         disp(<span class="string">'ERROR: Unable to read the data from the structure.'</span>)
0076         disp(<span class="string">' '</span>)
0077         model = [];
0078         <span class="keyword">return</span>
0079     <span class="keyword">end</span>
0080 <span class="keyword">end</span>
0081 
0082 <span class="comment">% define global variable for user's answers from input file</span>
0083 <span class="keyword">global</span> isAnswersFromFile AnswersFromFile AnswersIndex
0084 
0085 <span class="comment">% display loaded data</span>
0086 <a href="../../../BDLM_DATA_LOADER_9/functions/DataLoader/displayData.html" class="code" title="function displayData(data)">displayData</a>(data)
0087 
0088 <span class="comment">% Get number of time series in dataset</span>
0089 numberOfTimeSeries = length(data.labels);
0090 
0091 module = 0;
0092 <span class="comment">%% Define time series dependencies</span>
0093 <span class="keyword">if</span> numberOfTimeSeries &gt; 1
0094     
0095     ForbiddenIndexes=cell(numberOfTimeSeries,1);
0096     
0097     <span class="keyword">for</span> i=1:numberOfTimeSeries
0098         ForbiddenIndexes{i} = i;
0099     <span class="keyword">end</span>
0100     
0101     comp_ic = cell(1,numberOfTimeSeries);
0102     
0103     disp(<span class="string">' '</span>)
0104     module=module+1;
0105     
0106     <span class="keyword">for</span> i=1:numberOfTimeSeries
0107         isCorrect=false;
0108         <span class="keyword">while</span> ~isCorrect
0109             disp([ num2str(module) <span class="string">'  -  Identifies dependence between'</span> <span class="keyword">...</span>
0110                 <span class="string">'time series; use [0] to indicate no dependence'</span>])
0111             <span class="keyword">if</span> isAnswersFromFile
0112                 comp_ic{1,i}=eval(char(AnswersFromFile{1}(AnswersIndex)));
0113                 <span class="keyword">if</span> length( comp_ic{1,i}(:)) ~=1
0114                     disp([<span class="string">'     ['</span> sprintf(<span class="string">'%d,'</span>, comp_ic{1,i}(1:end-1) ) <span class="keyword">...</span>
0115                         num2str(comp_ic{1,i}(end)) <span class="string">']'</span>])
0116                 <span class="keyword">else</span>
0117                     disp([<span class="string">'     ['</span> num2str(comp_ic{1,i}(end)) <span class="string">']'</span>])
0118                 <span class="keyword">end</span>
0119             <span class="keyword">else</span>
0120                 comp_ic{1,i}=input([<span class="string">'    time serie #'</span> num2str(i) <span class="keyword">...</span>
0121                     <span class="string">' depends on time series # &gt;&gt; '</span>]);
0122             <span class="keyword">end</span>
0123             
0124             <span class="keyword">if</span> ~isempty(comp_ic{1,i})
0125                 <span class="keyword">for</span> j=1:length(comp_ic{1,i})
0126                     <span class="keyword">try</span>
0127                         ForbiddenIndexes{comp_ic{1,i}(j)}=  <span class="keyword">...</span>
0128                             [i ForbiddenIndexes{comp_ic{1,i}(j)} ];
0129                     <span class="keyword">catch</span>
0130                     <span class="keyword">end</span>
0131                 <span class="keyword">end</span>
0132             <span class="keyword">end</span>
0133             
0134             <span class="keyword">if</span> isempty(comp_ic{1,i})
0135                 disp(<span class="string">' '</span>)
0136                 disp([<span class="string">'%%%%%%%%%%%%%%%%%%%%%%%%%'</span> <span class="keyword">...</span>
0137                     <span class="string">'&gt; HELP &lt; %%%%%%%%%%%%%%%%%%%%%%%%%%'</span>])
0138                 disp(<span class="string">' '</span>)
0139                 disp([<span class="string">' Mention here whether some time series'</span><span class="keyword">...</span>
0140                     <span class="string">' depend on other time series.  '</span>])
0141                 disp(<span class="string">' '</span>)
0142                 disp([<span class="string">'%%%%%%%%%%%%%%%%%%%%%%%%%'</span> <span class="keyword">...</span>
0143                     <span class="string">'&gt; HELP &lt; %%%%%%%%%%%%%%%%%%%%%%%%%%'</span>])
0144                 disp(<span class="string">' '</span>)
0145                 <span class="keyword">continue</span>
0146             <span class="keyword">elseif</span> ischar(comp_ic{1,i})
0147                 disp(<span class="string">' '</span>)
0148                 disp(<span class="string">'     wrong input -&gt; should be integers'</span>)
0149                 disp(<span class="string">' '</span>)
0150                 <span class="keyword">continue</span>
0151             <span class="keyword">elseif</span> ~isempty(comp_ic{1,i}) &amp;&amp; any(rem(comp_ic{1,i},1))
0152                 disp(<span class="string">' '</span>)
0153                 disp(<span class="string">'     wrong input -&gt; should be integers'</span>)
0154                 disp(<span class="string">' '</span>)
0155                 <span class="keyword">continue</span>
0156             <span class="keyword">elseif</span> length(comp_ic{1,i})&gt;numberOfTimeSeries-1
0157                 <span class="comment">% || ~isempty(find([comp_ic{1}] &gt;4,1))</span>
0158                 disp(<span class="string">' '</span>)
0159                 disp(<span class="string">'     wrong input -&gt; invalid input'</span>)
0160                 disp(<span class="string">' '</span>)
0161                 <span class="keyword">continue</span>
0162                 
0163             <span class="keyword">elseif</span> any(ismember(comp_ic{1,i}, ForbiddenIndexes{i})) <span class="keyword">...</span>
0164                     || ~isempty(find(comp_ic{1,i}&gt;numberOfTimeSeries,1))
0165                 disp(<span class="string">' '</span>)
0166                 disp([<span class="string">'     wrong input -&gt; conflicts in the '</span> <span class="keyword">...</span>
0167                     <span class="string">'dependency vector.'</span>])
0168                 disp(<span class="string">' '</span>)
0169                 <span class="keyword">continue</span>
0170                 
0171                 
0172                 
0173             <span class="keyword">else</span>
0174                 <span class="keyword">if</span> comp_ic{1,i} == 0
0175                     comp_ic{1,i}=[];
0176                 <span class="keyword">end</span>
0177                 
0178                 isCorrect=true;
0179             <span class="keyword">end</span>
0180         <span class="keyword">end</span>
0181         AnswersIndex = AnswersIndex+1;
0182     <span class="keyword">end</span>
0183 <span class="keyword">else</span>
0184     comp_ic={[]};
0185 <span class="keyword">end</span>
0186 
0187 <span class="comment">%% Get number of model class</span>
0188 disp(<span class="string">' '</span>)
0189 module=module+1;
0190 isCorrect = false;
0191 <span class="keyword">while</span> ~isCorrect
0192     disp( [<span class="string">'- How many model classes do '</span> <span class="keyword">...</span>
0193         <span class="string">'you want for each time-series? '</span>])
0194     <span class="keyword">if</span> isAnswersFromFile
0195         nb_models=eval(char(AnswersFromFile{1}(AnswersIndex)));
0196         disp([<span class="string">'     '</span>, nb_models])
0197     <span class="keyword">else</span>
0198         nb_models=input(<span class="string">'     choice &gt;&gt; '</span>);
0199     <span class="keyword">end</span>
0200     <span class="keyword">if</span> isempty(nb_models)
0201         disp(<span class="string">' '</span>)
0202         disp(<span class="string">'%%%%%%%%%%%%%%%%%%%%%%%%% &gt; HELP &lt; %%%%%%%%%%%%%%%%%%%%%%%%'</span>)
0203         disp(<span class="string">'                                                         '</span>)
0204         disp([<span class="string">' Bayesian dynamic linear modelling enables to run more'</span> <span class="keyword">...</span>
0205             <span class="string">'than one model class to interpret time series with'</span> <span class="keyword">...</span>
0206             <span class="string">'switching dynamics.'</span>])
0207         disp([<span class="string">' This section allows to choose the number of model'</span> <span class="keyword">...</span>
0208             <span class="string">'class to process each time series.'</span>])
0209         disp(<span class="string">' A maximum of 2 model classes is supported. '</span>)
0210         disp(<span class="string">' '</span>)
0211         disp(<span class="string">'%%%%%%%%%%%%%%%%%%%%%%%%% &gt; HELP &lt; %%%%%%%%%%%%%%%%%%%%%%%%'</span>)
0212         disp(<span class="string">' '</span>)
0213         <span class="keyword">continue</span>
0214     <span class="keyword">elseif</span> length(nb_models) &gt; 1
0215         disp(<span class="string">' '</span>)
0216         disp(<span class="string">'     wrong input -&gt; should be a single integer'</span>)
0217         disp(<span class="string">' '</span>)
0218         <span class="keyword">continue</span>
0219     <span class="keyword">elseif</span> ischar(nb_models)|| rem(nb_models,1)~=0 || sign(nb_models) == -1
0220         disp(<span class="string">' '</span>)
0221         disp(<span class="string">'     wrong input -&gt; not a positive integer'</span>)
0222         disp(<span class="string">' '</span>)
0223         <span class="keyword">continue</span>
0224     <span class="keyword">elseif</span> nb_models &gt; 2
0225         disp(<span class="string">' '</span>)
0226         disp([<span class="string">'     wrong input -&gt; more than 2 model classes '</span> <span class="keyword">...</span>
0227             <span class="string">'is not supported.'</span>])
0228         disp(<span class="string">' '</span>)
0229         <span class="keyword">continue</span>
0230     <span class="keyword">else</span>
0231         isCorrect = true;
0232     <span class="keyword">end</span>
0233 <span class="keyword">end</span>
0234 AnswersIndex = AnswersIndex+1;
0235 
0236 
0237 <span class="comment">%% Identify model components for each model class and time series</span>
0238 disp(<span class="string">' '</span>)
0239 disp(<span class="string">'     --------------------------------------------------------'</span>)
0240 disp(<span class="string">'     BDLM Component reference numbers'</span>)
0241 disp(<span class="string">'     --------------------------------------------------------'</span>)
0242 disp(<span class="string">'     11: Local level'</span>)
0243 disp(<span class="string">'     12: Local trend'</span>)
0244 disp(<span class="string">'     13: Local acceleration'</span>)
0245 disp(<span class="string">'     21: Local level compatible with local trend'</span>)
0246 disp(<span class="string">'     22: Local level compatible with local acceleration'</span>)
0247 disp(<span class="string">'     23: Local trend compatible with local acceleration'</span>)
0248 disp(<span class="string">'     31: Periodic'</span>)
0249 disp(<span class="string">'     41: Autoregressive process (AR(1))'</span>)
0250 disp(<span class="string">'     51: Dynamic regression with hidden component'</span>)
0251 disp(<span class="string">'     52: Static kernel regression'</span>)
0252 disp(<span class="string">'     53: Dynamic kernel regression'</span>)
0253 disp(<span class="string">'     --------------------------------------------------------'</span>)
0254 disp(<span class="string">' '</span>)
0255 
0256 
0257 all_components=[11 12 13 21 22 23 31 41 51 52 53];
0258 level_components=[11 12 13 21 22 23];
0259 
0260 module=module+1;
0261 
0262 comp=cell(nb_models,numberOfTimeSeries);
0263 
0264 <span class="keyword">for</span> j=1:nb_models
0265     <span class="keyword">if</span> nb_models&gt;1
0266         disp([<span class="string">'    Model class #'</span> num2str(j)])
0267     <span class="keyword">end</span>
0268     <span class="keyword">for</span> i=1:numberOfTimeSeries
0269         isCorrect = false;
0270         <span class="keyword">while</span> ~isCorrect
0271             disp([<span class="string">'- Identify components for each'</span> <span class="keyword">...</span>
0272                 <span class="string">' model class and observation; e.g. [11 31 41]'</span>])
0273             <span class="keyword">if</span> isAnswersFromFile
0274                 comp{j}{i}=eval(char(AnswersFromFile{1}(AnswersIndex)));
0275                 <span class="keyword">if</span> length(comp{j}{i}(:)) ~=1
0276                     disp([<span class="string">'     ['</span> sprintf(<span class="string">'%d,'</span>, comp{j}{i}(1:end-1) ) <span class="keyword">...</span>
0277                         num2str(comp{j}{i}(end)) <span class="string">']'</span>])
0278                 <span class="keyword">else</span>
0279                     disp([<span class="string">'     ['</span> num2str(comp{j}{i}(end)) <span class="string">']'</span>])
0280                 <span class="keyword">end</span>
0281             <span class="keyword">else</span>
0282                 comp{j}{i}=input([<span class="string">'     time serie #'</span> num2str(i) <span class="string">' &gt;&gt; '</span>]);
0283             <span class="keyword">end</span>
0284             <span class="keyword">if</span> isempty(comp{j}{i})
0285                 disp(<span class="string">' '</span>)
0286                 disp([<span class="string">'%%%%%%%%%%%%%%%%%%%%%%%%% &gt; HELP &lt; %%%%%%%%%%%%'</span> <span class="keyword">...</span>
0287                     <span class="string">'%%%%%%%%%%%%%%'</span>])
0288                 disp(<span class="string">' '</span>)
0289                 disp([<span class="string">' Bayesian dynamic linear modelling requires'</span> <span class="keyword">...</span>
0290                     <span class="string">'a user''s defined model structure. '</span>])
0291                 disp([<span class="string">' The structure of the model is defined'</span> <span class="keyword">...</span>
0292                     <span class="string">'using components. '</span>])
0293                 disp(<span class="string">' There is one reference number per components.'</span>)
0294                 disp([<span class="string">' For instance, [11 31 41] builds a model with'</span> <span class="keyword">...</span>
0295                     <span class="string">'a local level, a periodic component,'</span> <span class="keyword">...</span>
0296                     <span class="string">'and an AR(1) process.'</span>])
0297                 disp(<span class="string">' '</span>)
0298                 disp([<span class="string">' The first six components are used to describe'</span> <span class="keyword">...</span>
0299                     <span class="string">'the baseline of the time series (level components).'</span>])
0300                 disp([<span class="string">' Compatibility rules for the level components'</span> <span class="keyword">...</span>
0301                     <span class="string">'apply between model classes. '</span>])
0302                 disp(<span class="string">' '</span>)
0303                 disp([<span class="string">' Default model parameters values are assigned '</span> <span class="keyword">...</span>
0304                     <span class="string">'to each model component.'</span>])
0305                 disp(<span class="string">' '</span>)
0306                 disp([<span class="string">'%%%%%%%%%%%%%%%%%%%%%%%%% &gt; HELP &lt; %%%%%%%%%%%%'</span> <span class="keyword">...</span>
0307                     <span class="string">'%%%%%%%%%%%%%%'</span>])
0308                 disp(<span class="string">' '</span>)
0309             <span class="keyword">elseif</span> ischar(comp{j}{i})
0310                 disp(<span class="string">' '</span>)
0311                 disp(<span class="string">'     wrong input -&gt; should be integers'</span>)
0312                 disp(<span class="string">' '</span>)
0313                 <span class="keyword">continue</span>
0314             <span class="keyword">elseif</span> ~all(ismember(comp{j}{i},all_components))
0315                 disp(<span class="string">' '</span>)
0316                 disp([<span class="string">'     wrong input -&gt; at least one component'</span> <span class="keyword">...</span>
0317                     <span class="string">' is unknown '</span>])
0318                 disp(<span class="string">' '</span>)
0319                 <span class="keyword">continue</span>
0320             <span class="keyword">elseif</span> ~all(ismember(comp{j}{i}(1),level_components))
0321                 disp(<span class="string">' '</span>)
0322                 disp([<span class="string">'     wrong input -&gt; first component should be a'</span> <span class="keyword">...</span>
0323                     <span class="string">' level component (i.e. either 11 12 13 21 22 23 )'</span>])
0324                 disp(<span class="string">' '</span>)
0325                 <span class="keyword">continue</span>
0326             <span class="keyword">elseif</span> length(comp{j}{i}) &gt; 1 &amp;&amp; <span class="keyword">...</span>
0327                     any(ismember(comp{j}{i}(2:end),level_components))
0328                 disp(<span class="string">' '</span>)
0329                 disp([<span class="string">'     wrong input -&gt; only the first component'</span> <span class="keyword">...</span>
0330                     <span class="string">' should be a level component'</span>])
0331                 disp(<span class="string">' '</span>)
0332                 <span class="keyword">continue</span>
0333             <span class="keyword">elseif</span> j == 1 &amp;&amp; nb_models&gt;1 &amp;&amp; <span class="keyword">...</span>
0334                     any(ismember(comp{j}{i}(1),level_components(1:3)))
0335                 disp(<span class="string">' '</span>)
0336                 disp([<span class="string">'     wrong input -&gt; the first component for'</span> <span class="keyword">...</span>
0337                     <span class="string">' model class 1 should be a level compatible'</span> <span class="keyword">...</span>
0338                     <span class="string">' component (i.e. either 21 22 23 )'</span>])
0339                 disp(<span class="string">' '</span>)
0340                 <span class="keyword">continue</span>
0341             <span class="keyword">elseif</span> j == 1 &amp;&amp; nb_models == 1 &amp;&amp; <span class="keyword">...</span>
0342                     any(ismember(comp{j}{i}(1),level_components(4:6)))
0343                 disp(<span class="string">' '</span>)
0344                 disp([<span class="string">'     wrong input -&gt; the first component for '</span> <span class="keyword">...</span>
0345                     <span class="string">'model class 1 should not be a level compatible '</span> <span class="keyword">...</span>
0346                     <span class="string">'component (i.e. only 11 12 13 are supported).'</span>])
0347                 disp(<span class="string">' '</span>)
0348                 <span class="keyword">continue</span>
0349             <span class="keyword">elseif</span> j == 2 &amp;&amp; nb_models&gt;1 &amp;&amp; comp{1}{i}(1) == 21 &amp;&amp; <span class="keyword">...</span>
0350                     comp{j}{i}(1) ~= 12
0351                 disp(<span class="string">' '</span>)
0352                 disp([<span class="string">'     wrong input -&gt; the level component'</span> <span class="keyword">...</span>
0353                     <span class="string">' for the two model classes are not compatibles'</span>])
0354                 disp(<span class="string">' '</span>)
0355                 <span class="keyword">continue</span>
0356             <span class="keyword">elseif</span> j == 2 &amp;&amp; nb_models&gt;1 &amp;&amp; comp{1}{i}(1) == 22 &amp;&amp; <span class="keyword">...</span>
0357                     comp{j}{i}(1) ~= 13
0358                 disp(<span class="string">' '</span>)
0359                 disp([<span class="string">'     wrong input -&gt; the level'</span> <span class="keyword">...</span>
0360                     <span class="string">' component for the two model classes are not'</span> <span class="keyword">...</span>
0361                     <span class="string">' compatibles'</span>])
0362                 disp(<span class="string">' '</span>)
0363                 <span class="keyword">continue</span>
0364             <span class="keyword">elseif</span> j == 2 &amp;&amp; nb_models&gt;1 &amp;&amp; comp{1}{i}(1) == 23 &amp;&amp; <span class="keyword">...</span>
0365                     comp{j}{i}(1) ~= 13
0366                 disp(<span class="string">' '</span>)
0367                 disp([<span class="string">'     wrong input -&gt; the level component '</span> <span class="keyword">...</span>
0368                     <span class="string">'for the two model classes are not compatibles'</span>])
0369                 disp(<span class="string">' '</span>)
0370                 <span class="keyword">continue</span>
0371             <span class="keyword">elseif</span> j&gt;1&amp;&amp; length(comp{j}{i})~=length(comp{j-1}{i})
0372                 disp(<span class="string">' '</span>)
0373                 disp([<span class="string">'     wrong input -&gt; all model'</span> <span class="keyword">...</span>
0374                     <span class="string">' classes must have the same number of components'</span>])
0375                 disp(<span class="string">' '</span>)
0376                 <span class="keyword">continue</span>
0377             <span class="keyword">else</span>
0378                 isCorrect=true;
0379                 AnswersIndex = AnswersIndex+1;
0380             <span class="keyword">end</span>
0381         <span class="keyword">end</span>
0382     <span class="keyword">end</span>
0383 <span class="keyword">end</span>
0384 
0385 <span class="comment">%% Identify constrained components</span>
0386 const=cell(nb_models,numberOfTimeSeries);
0387 disp(<span class="string">' '</span>)
0388 <span class="keyword">if</span> nb_models&gt;1
0389     module=module+1;
0390     <span class="keyword">for</span> j=2:nb_models
0391         disp([<span class="string">'    Model class #'</span> num2str(j)])
0392         <span class="keyword">for</span> i=1:numberOfTimeSeries
0393             isCorrect = false;
0394             <span class="keyword">while</span> ~isCorrect
0395                 disp([<span class="string">'- Identify shared parameters'</span> <span class="keyword">...</span>
0396                     <span class="string">' between the components of the model'</span> <span class="keyword">...</span>
0397                     <span class="string">' class #1; e.g. [0 1 1]'</span>])
0398                 <span class="keyword">if</span> isAnswersFromFile
0399                     const{j}{i}=eval(char(AnswersFromFile{1}(AnswersIndex)));
0400                     
0401                     <span class="keyword">if</span> length(const{j}{i}(:)) ~= 1
0402                     disp([<span class="string">'     ['</span> sprintf(<span class="string">'%d,'</span>, const{j}{i}(1:end-1) ) <span class="keyword">...</span>
0403                         num2str(const{j}{i}(end)) <span class="string">']'</span>])
0404                     <span class="keyword">else</span>
0405                          disp([<span class="string">'     ['</span> num2str(const{j}{i}(end)) <span class="string">']'</span>])
0406                     <span class="keyword">end</span>
0407                 <span class="keyword">else</span>
0408                     const{j}{i}=input([<span class="string">'     time serie #'</span> num2str(i) <span class="keyword">...</span>
0409                         <span class="string">' &gt;&gt; '</span>]);
0410                 <span class="keyword">end</span>
0411                 <span class="keyword">if</span> isempty(const{j}{i})
0412                     disp(<span class="string">' '</span>)
0413                     disp([<span class="string">'%%%%%%%%%%%%%%%%%%%%%%%%% &gt; HELP &lt; %%%%%%%'</span> <span class="keyword">...</span>
0414                         <span class="string">'%%%%%%%%%%%%%%%%%%%'</span>])
0415                     disp(<span class="string">' '</span>)
0416                     disp([<span class="string">' For a given component and two model '</span> <span class="keyword">...</span>
0417                         <span class="string">'classes, sharing model parameters implies of'</span> <span class="keyword">...</span>
0418                         <span class="string">'having the same parameters for the'</span> <span class="keyword">...</span>
0419                         <span class="string">'two model classes.  '</span>])
0420                     disp([<span class="string">' Sharing parameters between the same component'</span> <span class="keyword">...</span>
0421                         <span class="string">'of different model classes enables to reduce'</span> <span class="keyword">...</span>
0422                         <span class="string">'the total number of model parameters.'</span>])
0423                     disp(<span class="string">' '</span>)
0424                     disp([<span class="string">'%%%%%%%%%%%%%%%%%%%%%%%%% &gt; HELP &lt; %%%%%%%'</span> <span class="keyword">...</span>
0425                         <span class="string">'%%%%%%%%%%%%%%%%%%%'</span>])
0426                     disp(<span class="string">' '</span>)
0427                 <span class="keyword">elseif</span> length(const{j}{i})~=length(comp{j}{i})
0428                     disp(<span class="string">' '</span>)
0429                     disp([<span class="string">'     wrong input -&gt; the number of '</span> <span class="keyword">...</span>
0430                         <span class="string">'constraint parameters must be the same '</span> <span class="keyword">...</span>
0431                         <span class="string">'as the number of components'</span>])
0432                     disp(<span class="string">' '</span>)
0433                     <span class="keyword">continue</span>
0434                 <span class="keyword">elseif</span> ischar(const{j}{i})
0435                     disp(<span class="string">' '</span>)
0436                     disp(<span class="string">'     wrong input -&gt; should be integers'</span>)
0437                     disp(<span class="string">' '</span>)
0438                     <span class="keyword">continue</span>
0439                 <span class="keyword">elseif</span> ~all(ismember(const{j}{i}, [0,1]))
0440                     disp(<span class="string">' '</span>)
0441                     disp(<span class="string">'     wrong input -&gt; should be 0 or 1'</span>)
0442                     disp(<span class="string">' '</span>)
0443                     <span class="keyword">continue</span>
0444                 <span class="keyword">else</span>
0445                     isCorrect = true;
0446                     AnswersIndex = AnswersIndex+1;
0447                 <span class="keyword">end</span>
0448             <span class="keyword">end</span>
0449         <span class="keyword">end</span>
0450     <span class="keyword">end</span>
0451 <span class="keyword">end</span>
0452 
0453 
0454 
0455 model.nb_class = nb_models;
0456 
0457 
0458 <span class="comment">% Model blocks</span>
0459 <span class="keyword">for</span> j=1:nb_models
0460     str_3 = strings;
0461     <span class="keyword">for</span> i=1:numberOfTimeSeries
0462         str_1 = sprintf(<span class="string">'%d '</span>, comp{j}{i});
0463         str_2 = sprintf(<span class="string">'[%s] '</span>, str_1 );
0464         str_3 = [str_3 str_2];
0465     <span class="keyword">end</span>
0466     str_4 = sprintf(<span class="string">'model.components.block{%d}={%s};'</span>, j, strjoin(str_3) );
0467     eval(str_4)
0468 <span class="keyword">end</span>
0469 
0470 
0471 <span class="comment">% Model constrains</span>
0472 <span class="keyword">for</span> j=2:nb_models
0473     str_3 = strings;
0474     <span class="keyword">for</span> i=1:numberOfTimeSeries
0475         str_1 = sprintf(<span class="string">'%d '</span>, const{j}{i});
0476         str_2 = sprintf(<span class="string">'[%s] '</span>, str_1 );
0477         str_3 = [str_3 str_2];
0478     <span class="keyword">end</span>
0479     str_4 = sprintf(<span class="string">'model.components.const{%d}={%s};'</span>, j, strjoin(str_3) );
0480     eval(str_4)
0481 <span class="keyword">end</span>
0482 
0483 <span class="comment">% Observations interdependencies</span>
0484 str_3 = strings;
0485 <span class="keyword">for</span> j=1:numberOfTimeSeries
0486     str_1=sprintf(<span class="string">'%d '</span>,comp_ic{1,j});
0487     str_2 = sprintf(<span class="string">'[%s] '</span>, str_1 );
0488     str_3 = [str_3 str_2];
0489 <span class="keyword">end</span>
0490 str_4=sprintf(<span class="string">'model.components.ic={%s};'</span>, strjoin(str_3));
0491 eval(str_4)
0492 
0493 <span class="comment">%--------------------END CODE ------------------------</span>
0494 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Mon 18-Jun-2018 12:19:50 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>